<!doctype html> <lang="ru">
<head>
  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />

  <!-- iOS: fullscreen (–Ω–∞ —ç–∫—Ä–∞–Ω –¥–æ–º–æ–π) -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="@mind" />

  <!-- –¶–≤–µ—Ç —Å—Ç—Ä–æ–∫–∏ —Å—Ç–∞—Ç—É—Å–∞/–±—Ä–∞—É–∑–µ—Ä–∞ -->
  <meta name="theme-color" content="#050816" media="(prefers-color-scheme: dark)" />
  <meta name="theme-color" content="#f6f7fb" media="(prefers-color-scheme: light)" />

  <!-- –ò–∫–æ–Ω–∫–∏ (–í–ê–ñ–ù–û: –ø–µ—Ä–µ–∏–º–µ–Ω—É–π —Ñ–∞–π–ª —á—Ç–æ–±—ã —Å–±—Ä–æ—Å–∏—Ç—å –∫–µ—à iOS) -->
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon-v3.png" />
  <link rel="icon" type="image/png" sizes="192x192" href="logo-192-v3.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="logo-192-v3.png" />

  <!-- manifest (Android/Chrome) -->
  <link rel="manifest" href="manifest.webmanifest" />

  <title>@mind</title>
</head>


  <style>
    :root{
    
      --bg:#f6f7fb;
      --bg2:#ffffff;
      --text:#0b1220;
      --muted:rgba(11,18,32,.55);
      --card:rgba(255,255,255,.78);
      --card2:rgba(255,255,255,.62);
      --border:rgba(11,18,32,.12);
      --border2:rgba(109,94,252,.22);
      --accent:#6d5efc;
      --accent2:#a78bfa;
      --shadow: 0 12px 34px rgba(2,6,23,.12);
      --shadow2: 0 18px 50px rgba(109,94,252,.28);
      --radius:22px;
    }
html, body {
  height: 100%;
  min-height: 100%;
  margin: 0;
  background: var(--bg); /* –±–∞–∑–æ–≤—ã–π —Ñ–æ–Ω, –±–µ–∑ –±–µ–ª–æ–≥–æ */
}

body {
  background-color: var(--bg);
  overflow: hidden;
}

/* –í–ê–ñ–ù–û: —Ñ–æ–Ω —Ä–∏—Å—É–µ–º –Ω–∞ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —Å–ª–æ–µ, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
body::before{
  content:"";
  position: fixed;
  inset: 0;
  z-index: -1;
  background:
    radial-gradient(900px 700px at 20% 10%, rgba(109,94,252,.18), transparent 60%),
    radial-gradient(900px 700px at 80% 30%, rgba(167,139,250,.16), transparent 60%),
    radial-gradient(900px 700px at 60% 92%, rgba(109,94,252,.10), transparent 70%),
    linear-gradient(180deg, var(--bg), var(--bg2));
}


[data-theme="dark"]{
  --bg:#050816;
  --bg2:#070a1a;

  --text:#e9ecf3;
  --muted:rgba(233,236,243,.62);      /* –±—ã–ª–æ .55 ‚Äî —Å–¥–µ–ª–∞–µ–º –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–µ–µ */
  --card:rgba(7,10,26,.74);
  --card2:rgba(7,10,26,.62);

  --border:rgba(233,236,243,.14);     /* —á—É—Ç—å —Å–∏–ª—å–Ω–µ–µ –∫–æ–Ω—Ç—É—Ä */
  --border2:rgba(167,139,250,.28);
}


    *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }


    .app{
  height: calc(var(--vh, 1vh) * 100);
  display:flex;
  flex-direction:column;
}



    .top{
        padding-left: 16px;
        padding-right: 16px;
        padding-bottom: 10px;
        padding-top: calc(16px + env(safe-area-inset-top));
    }

    .header{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .brand{ display:flex; flex-direction:column; gap:2px; }
    .h-title{ font-weight:900; font-size:18px; letter-spacing:.2px; }
    .h-sub{ font-size:12px; color:var(--muted); }

    .iconBtn{
      width:44px;height:44px;border-radius:16px;
      border:1px solid var(--border);
      background:var(--card);
      box-shadow:var(--shadow);
      backdrop-filter: blur(12px);
      cursor:pointer;
      color:var(--text);
      display:flex;align-items:center;justify-content:center;
      user-select:none;
    }

    .metrics{ display:flex; gap:10px; margin-top:12px; }
    .metric{
      flex:1;min-width:0;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:16px;
      padding:10px 12px;
      box-shadow:var(--shadow);
      backdrop-filter: blur(12px);
    }
    .metric .k{ font-size:11px; color:var(--muted); }
    .metric .v{ margin-top:2px; font-size:16px; font-weight:900; }
    .metric .v{
  color: var(--text);
}
.metric .k{
  color: var(--muted);
}
.h-title{
  color: var(--text);
}
.h-sub{
  color: var(--muted);
}


    .main{
      flex:1;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      padding: 0 16px;
      overflow:hidden;
    }

    .sphereSection{
      width:100%;
      max-width:430px;
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      padding-bottom: 22px;
    }

    .sphereWrap{
      position:relative;
      width: min(420px, 92vw);
      aspect-ratio: 1 / 1;
      border-radius: 28px;
      overflow: hidden;
      background:
        radial-gradient(closest-side at 50% 44%, rgba(109,94,252,.14), transparent 68%),
        radial-gradient(closest-side at 60% 60%, rgba(167,139,250,.10), transparent 70%);
      touch-action:none;
    }

    .softGlow{
      position:absolute; inset:-40px;
      background: radial-gradient(closest-side, rgba(167,139,250,.18), transparent 70%);
      filter: blur(18px);
      opacity:.75;
      pointer-events:none;
      animation: breathe 4.6s ease-in-out infinite;
    }
    @keyframes breathe{ 0%,100%{ transform: scale(1); } 50%{ transform: scale(1.06); } }

    .sphere{ position:absolute; inset:0; transform-style:preserve-3d; will-change:transform; }
    .node{ position:absolute; left:50%; top:50%; transform-style:preserve-3d; will-change:transform; }

    .chip{
      display:flex; align-items:center; gap:8px;
      padding: 9px 12px;
      border-radius: 18px;
      border: 1px solid var(--border2);
      background: var(--card2);
      backdrop-filter: blur(14px);
      box-shadow: 0 10px 26px rgba(2,6,23,.10);
      color:var(--text);
      font-size:12px;
      font-weight:900;
      white-space:nowrap;
      cursor:pointer;
      user-select:none;
      transition: transform .15s ease, opacity .15s ease, filter .15s ease;
    }
    .chip:active{ transform: scale(.98); }
    .chip .e{ font-size:16px; }

    .bottomBar{
      position:fixed;
      left:0; right:0;
      bottom:0;
      padding: 10px 16px calc(14px + env(safe-area-inset-bottom));
      background: linear-gradient(180deg, rgba(255,255,255,0), var(--card));
      backdrop-filter: blur(14px);
      border-top: 1px solid var(--border);
      display:flex;
      justify-content:center;
      z-index:20;
    }
    [data-theme="dark"] .bottomBar{
      background: linear-gradient(180deg, rgba(0,0,0,0), var(--card));
    }

    .primaryBtn{
      width: min(430px, 100%);
      height: 52px;
      border-radius: 999px;
      border: 1px solid rgba(109,94,252,.25);
      background: linear-gradient(135deg, rgba(109,94,252,.95), rgba(167,139,250,.85));
      color:#fff;
      font-weight: 950;
      letter-spacing:.2px;
      box-shadow: var(--shadow2);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      user-select:none;
    }

    .modalBg{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.42);
      display:none;
      align-items:flex-end;
      justify-content:center;
      padding: 10px 10px calc(10px + env(safe-area-inset-bottom));
      backdrop-filter: blur(10px);
      z-index:50;
    }
    .modalBg.show{ display:flex; }

    .modal{
      width: min(560px, 100%);
      background: var(--card);
      border:1px solid var(--border);
      border-radius: 26px;
      box-shadow: var(--shadow);
      padding: 14px;
      backdrop-filter: blur(14px);
      max-height: 86vh;
      overflow:auto;
    }

    .modalTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .modalTitle{ font-weight: 950; font-size: 14px; }
    .modalHint{
      margin-top:6px;
      font-size: 12px;
      color: var(--muted);
      line-height:1.35;
    }

    .toolbar{
      display:flex;
      gap:8px;
      margin-top:12px;
      flex-wrap:wrap;
    }
    .tbtn{
      border:1px solid var(--border);
      background: transparent;
      color: var(--text);
      border-radius: 12px;
      padding: 8px 10px;
      cursor:pointer;
      user-select:none;
      font-weight: 900;
      font-size: 12px;
      min-width: 42px;
      text-align:center;
    }
    .tbtn.active{
      background: rgba(109,94,252,.16);
      border-color: rgba(109,94,252,.28);
      box-shadow: 0 10px 22px rgba(109,94,252,.10);
    }

    .editor{
      margin-top:10px;
      min-height: 220px;
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 12px;
      outline:none;
      background: transparent;
      color: var(--text);
      font-size: 15px;
      line-height: 1.4;
      overflow:auto;
      -webkit-user-select:text;
      user-select:text;
    }
    .editor:empty:before{ content: attr(data-placeholder); color: var(--muted); }

    .saveBtn{
      margin-top:12px;
      width: 100%;
      height: 48px;
      border-radius: 18px;
      border: 1px solid rgba(109,94,252,.25);
      background: linear-gradient(135deg, rgba(109,94,252,.95), rgba(167,139,250,.80));
      color:#fff;
      font-weight: 950;
      cursor:pointer;
    }

    .journalHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .journalTitle{ font-weight: 950; font-size: 14px; }

    .emptyBox{
      margin-top:10px;
      border:1px dashed var(--border);
      border-radius: 18px;
      padding: 12px;
      color: var(--muted);
      font-size: 13px;
      line-height:1.35;
      background: rgba(255,255,255,.03);
    }

    .entry{
      border:1px solid var(--border);
      background: rgba(255,255,255,.02);
      border-radius: 18px;
      padding: 12px;
      margin-top: 10px;
      position:relative;
    }
    .entryTop{
  display:grid;
  grid-template-columns: 1fr auto; /* —Å–ª–µ–≤–∞ —Ç–µ–≥, —Å–ø—Ä–∞–≤–∞ –ø–∞–Ω–µ–ª—å */
  align-items:start;
  gap:10px;
  font-size:12px;
  color: var(--muted);
}

.entryTag{
  display:flex;
  align-items:center;
  gap:8px;
  font-weight:900;
  color: var(--text);
  min-width:0;

  /* —á—Ç–æ–±—ã –¥–ª–∏–Ω–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –Ω–µ –ª–æ–º–∞–ª–∏ –≤–µ—Ä—Å—Ç–∫—É */
  overflow:hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.entryRight{
  display:grid;
  grid-auto-flow: column;
  grid-auto-columns: max-content;
  align-items:center;
  gap:8px;
}

.entryDate{
  font-size:11px;
  color: var(--muted);
  margin-left: 6px;
  white-space: nowrap;
}

.progressPill{
  padding: 5px 8px;
  border-radius: 999px;
  border:1px solid var(--border);
  background: rgba(255,255,255,.03);
  font-weight: 900;
  font-size: 11px;
  min-width: 56px;
  text-align:center;
}

.miniBtn{
  width:32px;
  height:32px;
  border-radius:12px;
  border:1px solid var(--border);
  background:transparent;
  cursor:pointer;
  display:flex;
  align-items:center;
  justify-content:center;
}

    .pinBtn.pinned{
      background: rgba(109,94,252,.14);
      border-color: rgba(109,94,252,.24);
    }
    .progressPill{
      padding: 6px 10px;
      border-radius: 999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      font-weight: 900;
      font-size: 12px;
      color: var(--text);
      min-width: 62px;
      text-align:center;
      user-select:none;
    }

    .entryText{
      margin-top:8px;
      font-size: 14px;
      line-height: 1.4;
      color: var(--text);
      overflow-wrap: anywhere;
    }

    .pop{
      margin-top:10px;
      border:1px solid var(--border);
      border-radius: 16px;
      padding: 12px;
      background: rgba(255,255,255,.04);
    }
    .popTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-size:12px;
      color: var(--muted);
    }
    .popVal{ font-weight: 950; color: var(--text); }

    .rangeWrap{ margin-top:10px; }

    input[type="range"]{
      -webkit-appearance:none;
      width:100%;
      height: 10px;
      border-radius: 999px;
      background: rgba(11,18,32,.10);
      outline:none;
    }
    [data-theme="dark"] input[type="range"]{
      background: rgba(233,236,243,.12);
    }

    input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance:none;
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: var(--accent);
      border: 2px solid rgba(255,255,255,.85);
      box-shadow: 0 10px 22px rgba(2,6,23,.20);
      cursor:pointer;
    }
    input[type="range"]::-moz-range-thumb{
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: var(--accent);
      border: 2px solid rgba(255,255,255,.85);
      box-shadow: 0 10px 22px rgba(2,6,23,.20);
      cursor:pointer;
    }

    /* Onboarding */
    .onbSheet{
      width:min(560px, 100%);
      border-radius: 26px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.70);
      box-shadow: 0 18px 60px rgba(2,6,23,.22);
      backdrop-filter: blur(16px);
      padding: 14px;
      position:relative;
      overflow:hidden;
    }
    [data-theme="dark"] .onbSheet{
      background: rgba(7,10,26,.72);
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
    }
    .onbGlow{
      position:absolute; inset:-80px;
      background: conic-gradient(
        from 0deg,
        rgba(109,94,252,.20),
        rgba(167,139,250,.18),
        rgba(109,94,252,.20),
        rgba(167,139,250,.18),
        rgba(109,94,252,.20)
      );
      filter: blur(24px);
      opacity:.75;
      animation: shimmer 4.6s linear infinite;
      pointer-events:none;
    }
    @keyframes shimmer{
      0%{ transform: rotate(0deg); }
      100%{ transform: rotate(360deg); }
    }
    .onbContent{
      position:relative;
      z-index:1;
      text-align:center;
      padding: 10px 6px 6px;
    }
    .onbHeart{
      font-size: 28px;
      margin-top: 4px;
    }
    .onbText{
      margin-top:8px;
      font-size: 13px;
      color: var(--muted);
      line-height:1.4;
    }
    .onbBtn{
      margin-top:12px;
      width:100%;
      height: 48px;
      border-radius: 18px;
      border: 1px solid rgba(109,94,252,.25);
      background: linear-gradient(135deg, rgba(109,94,252,.95), rgba(167,139,250,.85));
      color:#fff;
      font-weight: 950;
      cursor:pointer;
      user-select:none;
    }

    .noSelect{
      user-select:none;
      -webkit-user-select:none;
    }
    @media (max-width: 420px){
  .h-title{ font-size: 17px; }
  .h-sub{ font-size: 11px; }

  .metric .v{ font-size: 15px; }
  .chip{ font-size: 11px; padding: 8px 10px; border-radius: 16px; }
  .chip .e{ font-size: 15px; }

  .entryText{
    font-size: 13px;
    line-height: 1.35;
  }

  .modal{
    border-radius: 22px;
    padding: 12px;
  }
}
/* –û–Ω–±–æ—Ä–¥–∏–Ω–≥ ‚Äî –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–µ —Ü–≤–µ—Ç–∞ */
.onbSheet .modalTitle{
  color: var(--text);
}
.onbText{
  color: var(--muted);
}

/* —á—É—Ç—å —è—Ä—á–µ —Ñ–æ–Ω –Ω–∞ —Ç—ë–º–Ω–æ–π —Ç–µ–º–µ */
[data-theme="dark"] .onbSheet{
  background: rgba(7,10,26,.82);
  border-color: rgba(233,236,243,.14);
}


  </style>
</head>

<body>
  <div class="app">
    <div class="top">
      <div class="header">
        <div class="brand">
          <div class="h-title">@mind</div>
          <div class="h-sub">–î–Ω–µ–≤–Ω–∏–∫ —Å–∞–º–æ–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è</div>
        </div>
        <button class="iconBtn noSelect" id="themeBtn" aria-label="–¢–µ–º–∞" title="–¢–µ–º–∞">üåì</button>
      </div>

      <div class="metrics">
        <div class="metric">
          <div class="k">–°–µ—Ä–∏—è –¥–Ω–µ–π</div>
          <div class="v" id="mStreak">0 üî•</div>
        </div>
        <div class="metric">
          <div class="k">–°–µ–≥–æ–¥–Ω—è</div>
          <div class="v" id="mToday">0 üìù</div>
        </div>
      </div>
    </div>

    <div class="main">
      <div class="sphereSection">
        <div class="sphereWrap" id="sphereWrap">
          <div class="softGlow"></div>
          <div class="sphere" id="sphere"></div>
        </div>
      </div>
    </div>

    <div class="bottomBar">
      <button class="primaryBtn noSelect" id="openJournalBtn">
        <span style="font-size:18px">üìì</span>
        <span>–û—Ç–∫—Ä—ã—Ç—å –¥–Ω–µ–≤–Ω–∏–∫</span>
      </button>
    </div>
  </div>

  <!-- Onboarding modal (always on open) -->
  <div class="modalBg" id="onbModalBg">
    <div class="onbSheet" role="dialog" aria-modal="true">
      <div class="onbGlow"></div>
      <div class="onbContent">
        <div class="onbHeart">üíó</div>
        <div class="modalTitle" style="margin-top:8px;">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è</div>
        <div class="onbText">
          1) –ö—Ä—É—Ç–∏ —Å—Ñ–µ—Ä—É –≤–±–æ–∫ –∏ –≤—ã–±–µ—Ä–∏ —Å–µ–∫—Ç–æ—Ä.<br>
          2) –ó–∞–ø–∏—à–∏ –º—ã—Å–ª—å –∏ –æ—Ñ–æ—Ä–º–∏ —Ç–µ–∫—Å—Ç (–∂–∏—Ä–Ω—ã–π, –∫—É—Ä—Å–∏–≤, —Å–ø–∏—Å–æ–∫, —Ü–≤–µ—Ç).<br>
          3) –û—Ç–∫—Ä–æ–π –¥–Ω–µ–≤–Ω–∏–∫ —Å–Ω–∏–∑—É: –∑–∞–∫—Ä–µ–ø–ª—è–π –≤–∞–∂–Ω–æ–µ üìå –∏ –æ—Ç–º–µ—á–∞–π –ø—Ä–æ–≥—Ä–µ—Å—Å üìà.<br>
          –í—Å—ë —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.
        </div>
        <button class="onbBtn noSelect" id="onbContinue">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
      </div>
    </div>
  </div>

  <!-- Entry editor modal -->
  <div class="modalBg" id="entryModalBg">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modalTop">
        <div class="modalTitle" id="entryTitle">üìù –ó–∞–ø–∏—Å—å</div>
        <button class="iconBtn noSelect" id="entryClose" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>
      <div class="modalHint" id="entryHint"></div>

      <div class="toolbar noSelect">
        <button class="tbtn" id="tbBold" title="–ñ–∏—Ä–Ω—ã–π"><b>B</b></button>
        <button class="tbtn" id="tbItalic" title="–ö—É—Ä—Å–∏–≤"><i>I</i></button>
        <button class="tbtn" id="tbList" title="–°–ø–∏—Å–æ–∫">‚Ä¢</button>
        <button class="tbtn" id="tbUndo" title="–û—Ç–º–µ–Ω–∞">‚Ü∫</button>
        <button class="tbtn" id="tbColor" title="–¶–≤–µ—Ç">A</button>
      </div>

      <div class="editor" id="editor" contenteditable="true"
        data-placeholder="–ü–∏—à–∏ –∫–∞–∫ –≤ –ª–∏—á–Ω—ã–π –¥–Ω–µ–≤–Ω–∏–∫. –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –±—ã—Ç—å –Ω–∞—Å—Ç–æ—è—â–∏–º."></div>

      <button class="saveBtn noSelect" id="saveEntryBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>

  <!-- Journal modal -->
  <div class="modalBg" id="journalModalBg">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="journalHeader">
        <div class="journalTitle">üìì –î–Ω–µ–≤–Ω–∏–∫</div>
        <button class="iconBtn noSelect" id="journalClose" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>

      <div id="journalBody"></div>
    </div>
  </div>

  <script>
    // --------- Data ----------
    const segments = [
      { id: 1,  name: "–ú—ã—Å–ª–∏",           emoji: "üí≠" },
      { id: 2,  name: "–ß—É–≤—Å—Ç–≤–∞",         emoji: "üòî" },
      { id: 3,  name: "–°–∞–º–æ–æ—Ü–µ–Ω–∫–∞",      emoji: "‚ú®" },
      { id: 4,  name: "–ú—ã—à–ª–µ–Ω–∏–µ",        emoji: "üß†" },
      { id: 5,  name: "–¢—Ä–µ–≤–æ–≥–∞",         emoji: "üåô" },
      { id: 6,  name: "–ú–æ—Ç–∏–≤–∞—Ü–∏—è",       emoji: "üî•" },
      { id: 7,  name: "–†–æ—Å—Ç",            emoji: "ü¶ã" },
      { id: 8,  name: "–ò–Ω—Ç—É–∏—Ü–∏—è",        emoji: "üßø" },
      { id: 9,  name: "–°—Ç—Ä–∞—Ö–∏",          emoji: "üíî" },
      { id: 10, name: "–õ—é–±–æ–≤—å –∫ —Å–µ–±–µ",   emoji: "üíñ" },
      { id: 11, name: "–≠–Ω–µ—Ä–≥–∏—è",         emoji: "üõå" },
      { id: 12, name: "–ú–µ—á—Ç–∞",           emoji: "üíº" },
      { id: 13, name: "–î–µ–Ω—å–≥–∏",          emoji: "üí∏" },
      { id: 14, name: "–ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å",   emoji: "üå∏" },
      { id: 15, name: "–Ø—Å–Ω–æ—Å—Ç—å",         emoji: "üß©" },
      { id: 16, name: "–≠–º–æ—Ü–∏–∏",          emoji: "üåä" },
      { id: 17, name: "–í–∏–¥–µ–Ω–∏–µ",         emoji: "üîÆ" },
      { id: 18, name: "–°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ",     emoji: "üïä" },
      { id: 19, name: "–°–∏–ª–∞",            emoji: "‚ö°Ô∏è" },
      { id: 20, name: "–°–≤–æ–±–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç", emoji: "üìù" },
    ];

    const LS = {
      theme: "mind_theme",
      entries: "mind_entries_v4",
    };

    function loadJSON(key, fallback){
      try{
        const raw = localStorage.getItem(key);
        if(!raw) return fallback;
        return JSON.parse(raw);
      }catch{
        return fallback;
      }
    }
    function saveJSON(key, val){ localStorage.setItem(key, JSON.stringify(val)); }
    function dayKey(iso){ return new Date(iso).toISOString().slice(0,10); }
    function nowISO(){ return new Date().toISOString(); }

    // Progress color: red (0) -> green (100)
    function progressColor(percent){
      const p = Math.max(0, Math.min(100, percent));
      const hue = 0 + (120 * (p / 100)); // 0..120
      return `hsl(${hue} 85% 45%)`;
    }
    function setRangeGradient(rangeEl, percent){
      const c = progressColor(percent);
      const neutralLight = "rgba(11,18,32,.12)";
      const neutralDark  = "rgba(233,236,243,.14)";
      const neutral = (document.body.dataset.theme === "dark") ? neutralDark : neutralLight;
      rangeEl.style.background =
        `linear-gradient(90deg, ${c} 0%, ${c} ${percent}%, ${neutral} ${percent}%, ${neutral} 100%)`;
    }

    // --------- State ----------
    let entries = loadJSON(LS.entries, []).map(e => ({
      ...e,
      pinned: !!e.pinned,
      progress: typeof e.progress === "number" ? e.progress : 0,
    }));

    let activeSegment = null;

    // Sphere rotation: sideways only
    const fixedTiltX = -12;
    let rotY = 18;
    let dragging = false;
    let lastX = 0;

    // Journal popover
    let openProgressForId = null;

    // --------- Elements ----------
    const themeBtn = document.getElementById("themeBtn");
    const mStreak = document.getElementById("mStreak");
    const mToday  = document.getElementById("mToday");

    const sphereWrap = document.getElementById("sphereWrap");
    const sphereEl   = document.getElementById("sphere");

    const onbModalBg = document.getElementById("onbModalBg");
    const onbContinue= document.getElementById("onbContinue");

    const entryModalBg = document.getElementById("entryModalBg");
    const entryTitle   = document.getElementById("entryTitle");
    const entryHint    = document.getElementById("entryHint");
    const entryClose   = document.getElementById("entryClose");
    const editor       = document.getElementById("editor");
    const saveEntryBtn = document.getElementById("saveEntryBtn");

    const journalModalBg = document.getElementById("journalModalBg");
    const journalClose   = document.getElementById("journalClose");
    const journalBody    = document.getElementById("journalBody");
    const openJournalBtn = document.getElementById("openJournalBtn");

    const tbBold  = document.getElementById("tbBold");
    const tbItalic= document.getElementById("tbItalic");
    const tbList  = document.getElementById("tbList");
    const tbUndo  = document.getElementById("tbUndo");
    const tbColor = document.getElementById("tbColor");

    // --------- Theme ----------
    function initTheme(){
      const t = localStorage.getItem(LS.theme);
      document.body.dataset.theme = (t === "dark") ? "dark" : "light";
    }
    function toggleTheme(){
      const cur = document.body.dataset.theme === "dark" ? "dark" : "light";
      const next = cur === "dark" ? "light" : "dark";
      document.body.dataset.theme = next;
      localStorage.setItem(LS.theme, next);

      const openRange = document.querySelector('input[type="range"][data-open="1"]');
      if(openRange){
        setRangeGradient(openRange, Number(openRange.value));
      }
    }

    // --------- Metrics ----------
    function computeMetrics(){
      const today = dayKey(nowISO());
      const todayCount = entries.filter(e => dayKey(e.createdAt) === today).length;

      const daysSet = new Set(entries.map(e => dayKey(e.createdAt)));
      let streak = 0;
      let cur = today;
      while(daysSet.has(cur)){
        streak++;
        const d = new Date(cur);
        d.setDate(d.getDate() - 1);
        cur = d.toISOString().slice(0,10);
      }
      return { streak, todayCount };
    }
    function renderMetrics(){
      const m = computeMetrics();
      mStreak.textContent = `${m.streak} üî•`;
      mToday.textContent  = `${m.todayCount} üìù`;
    }

    // --------- Sphere ----------
    const nodes = [];
    function buildSphere(){
      sphereEl.innerHTML = "";
      nodes.length = 0;

      for(let i=0;i<segments.length;i++){
        const seg = segments[i];
        const node = document.createElement("div");
        node.className = "node";

        const chip = document.createElement("div");
        chip.className = "chip noSelect";
        chip.innerHTML = `<span class="e">${seg.emoji}</span><span>${seg.name}</span>`;
        chip.addEventListener("click", (ev) => {
          ev.preventDefault();
          ev.stopPropagation();
          openEntry(seg);
        });

        node.appendChild(chip);
        sphereEl.appendChild(node);
        nodes.push({ node, chip, seg });
      }
      layoutSphere();
    }

    function layoutSphere(){
      const rect = sphereWrap.getBoundingClientRect();
      const radius = Math.min(rect.width, rect.height) * 0.36;

      sphereEl.style.transform = `rotateX(${fixedTiltX}deg) rotateY(${rotY}deg)`;

      const N = nodes.length;
      for(let i=0;i<N;i++){
        const t = (i + 0.5) / N;
        const phi = Math.acos(1 - 2*t);
        const theta = Math.PI * (1 + Math.sqrt(5)) * i;

        const x = radius * Math.sin(phi) * Math.cos(theta);
        const y = radius * Math.cos(phi);
        const z = radius * Math.sin(phi) * Math.sin(theta);

        const depth = (z / radius + 1) / 2;
        const uiScale = 0.82 + depth * 0.36;
        const uiAlpha = 0.35 + depth * 0.65;

        const item = nodes[i];
        item.node.style.transform =
          `translate3d(calc(-50% + ${x}px), calc(-50% + ${y}px), ${z}px)
           rotateX(${-fixedTiltX}deg) rotateY(${-rotY}deg)`;

        item.chip.style.opacity = uiAlpha.toFixed(3);
        item.chip.style.transform = `scale(${uiScale.toFixed(3)})`;
        item.chip.style.filter = uiAlpha < 0.45 ? "blur(0.25px)" : "none";
        item.chip.style.pointerEvents = "auto";
      }
    }

    let raf = 0;
    function tick(){
      raf = requestAnimationFrame(tick);
      if(!dragging){
        rotY += 0.12;
        layoutSphere();
      }
    }

    function onDown(e){ dragging = true; lastX = e.clientX; }
    function onMove(e){
      if(!dragging) return;
      const dx = e.clientX - lastX;
      rotY += dx * 0.22;
      lastX = e.clientX;
      layoutSphere();
    }
    function onUp(){ dragging = false; }

    

    // --------- Entry modal ----------
    function pickHint(){
      const hints = [
        "–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –º—ã—Å–ª—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ —á–µ—Å—Ç–Ω–æ. –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –±—ã—Ç—å –Ω–∞—Å—Ç–æ—è—â–∏–º.",
        "–ß—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç—ã —Ö–æ—á–µ—à—å –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤ –º—ã—à–ª–µ–Ω–∏–∏ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å?",
        "–û–¥–Ω–∞ —Ñ—Ä–∞–∑–∞, –∫–æ—Ç–æ—Ä–∞—è —Å–¥–µ–ª–∞–µ—Ç —Ç–µ–±—è —Å–∏–ª—å–Ω–µ–µ –≤ –±–ª–∏–∂–∞–π—à–∏–µ —Å—É—Ç–∫–∏.",
        "–ù–∞–ø–∏—à–∏ —ç—Ç–æ –∫–∞–∫ –º—è–≥–∫—É—é –∫–æ–º–∞–Ω–¥—É —Å–µ–±–µ –Ω–∞ –∑–∞–≤—Ç—Ä–∞.",
        "–ß—Ç–æ —Ç—ã –≤—ã–±–∏—Ä–∞–µ—à—å –¥—É–º–∞—Ç—å –≤–º–µ—Å—Ç–æ —Å—Ç–∞—Ä–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä–∏—è?",
      ];
      return hints[Math.floor(Math.random() * hints.length)];
    }

    function openEntry(seg){
      activeSegment = seg;
      entryTitle.textContent = `${seg.emoji} ${seg.name}`;
      entryHint.textContent = pickHint();
      editor.innerHTML = "";
      entryModalBg.classList.add("show");
      setTimeout(() => editor.focus(), 0);
      updateToolbarState();
    }
    function closeEntry(){
      entryModalBg.classList.remove("show");
      activeSegment = null;
      editor.innerHTML = "";
      setTimeout(setVh, 50);
    }
    function saveEntry(){
      if(!activeSegment) return;
      const html = editor.innerHTML.trim();
      const textOnly = editor.textContent.trim();
      if(!html || !textOnly) return;

      const entry = {
        id: crypto.randomUUID(),
        segmentId: activeSegment.id,
        segmentName: activeSegment.name,
        segmentEmoji: activeSegment.emoji,
        html,
        createdAt: nowISO(),
        pinned: false,
        progress: 0,
      };

      entries.push(entry);
      saveJSON(LS.entries, entries);
      renderMetrics();
      closeEntry();
    }

    // --------- Toolbar toggle/active ----------
    function execCmd(cmd){
      document.execCommand(cmd, false, null);
      editor.focus();
      updateToolbarState();
    }

    function isInColoredSpan(){
      const sel = window.getSelection();
      if(!sel || sel.rangeCount === 0) return false;
      let node = sel.anchorNode;
      if(!node) return false;
      if(node.nodeType === 3) node = node.parentNode;
      while(node && node !== editor){
        if(node.nodeType === 1 && node.tagName === "SPAN" && node.dataset && node.dataset.mindColor === "accent"){
          return true;
        }
        node = node.parentNode;
      }
      return false;
    }

    function unwrapAccentInRange(range){
      const spans = editor.querySelectorAll('span[data-mind-color="accent"]');
      spans.forEach(sp => {
        const spRange = document.createRange();
        spRange.selectNodeContents(sp);
        const intersects =
          range.compareBoundaryPoints(Range.END_TO_START, spRange) < 0 &&
          range.compareBoundaryPoints(Range.START_TO_END, spRange) > 0;
        if(intersects){
          const parent = sp.parentNode;
          while(sp.firstChild){
            parent.insertBefore(sp.firstChild, sp);
          }
          parent.removeChild(sp);
        }
      });
    }

    function toggleAccentColor(){
      const sel = window.getSelection();
      if(!sel || sel.rangeCount === 0) return;

      const range = sel.getRangeAt(0);

      if(range.collapsed){
        const already = isInColoredSpan();
        if(already){
          // move caret out
          const node = sel.anchorNode && sel.anchorNode.nodeType === 3 ? sel.anchorNode.parentNode : sel.anchorNode;
          let span = node;
          while(span && span !== editor && !(span.tagName === "SPAN" && span.dataset && span.dataset.mindColor === "accent")){
            span = span.parentNode;
          }
          if(span && span !== editor){
            const after = document.createTextNode("");
            span.parentNode.insertBefore(after, span.nextSibling);
            const r = document.createRange();
            r.setStart(after, 0);
            r.collapse(true);
            sel.removeAllRanges();
            sel.addRange(r);
          }
        }else{
          const span = document.createElement("span");
          span.dataset.mindColor = "accent";
          span.style.color = "#6d5efc";
          span.appendChild(document.createTextNode("\u200B"));
          range.insertNode(span);

          const r = document.createRange();
          r.setStart(span.firstChild, 1);
          r.collapse(true);
          sel.removeAllRanges();
          sel.addRange(r);
        }
        editor.focus();
        updateToolbarState();
        return;
      }

      const already = isInColoredSpan();
      if(already){
        unwrapAccentInRange(range);
      }else{
        const span = document.createElement("span");
        span.dataset.mindColor = "accent";
        span.style.color = "#6d5efc";
        try{
          range.surroundContents(span);
        }catch{
          document.execCommand("foreColor", false, "#6d5efc");
        }
      }
      editor.focus();
      updateToolbarState();
    }

    function updateToolbarState(){
      try{
        tbBold.classList.toggle("active", document.queryCommandState("bold"));
        tbItalic.classList.toggle("active", document.queryCommandState("italic"));
        tbList.classList.toggle("active", document.queryCommandState("insertUnorderedList"));
      }catch{}
      tbColor.classList.toggle("active", isInColoredSpan());
      tbUndo.classList.remove("active");
    }

    document.addEventListener("selectionchange", () => {
      if(!entryModalBg.classList.contains("show")) return;
      const sel = window.getSelection();
      if(!sel || !sel.anchorNode) return;
      let n = sel.anchorNode.nodeType === 3 ? sel.anchorNode.parentNode : sel.anchorNode;
      while(n){
        if(n === editor){
          updateToolbarState();
          return;
        }
        n = n.parentNode;
      }
    });

    // --------- Journal (pin/progress/delete) ----------
    function openJournal(){
      openProgressForId = null;
      renderJournal();
      journalModalBg.classList.add("show");
    }
    function closeJournal(){
      journalModalBg.classList.remove("show");
      openProgressForId = null;
      setTimeout(setVh, 50);
    }

    function togglePin(entryId){
      const idx = entries.findIndex(e => e.id === entryId);
      if(idx === -1) return;
      entries[idx].pinned = !entries[idx].pinned;
      saveJSON(LS.entries, entries);
      renderJournal();
    }

    function toggleProgressMenu(entryId){
      openProgressForId = (openProgressForId === entryId) ? null : entryId;
      renderJournal();
    }

    function setProgress(entryId, value){
      const idx = entries.findIndex(e => e.id === entryId);
      if(idx === -1) return;
      entries[idx].progress = value;
      saveJSON(LS.entries, entries);
      renderJournal();
    }

    function deleteEntry(entryId){
      const ok = confirm("–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.");
      if(!ok) return;
      entries = entries.filter(e => e.id !== entryId);
      saveJSON(LS.entries, entries);
      renderMetrics();
      renderJournal();
    }

    function renderJournal(){
      journalBody.innerHTML = "";

      if(entries.length === 0){
        const empty = document.createElement("div");
        empty.className = "emptyBox";
        empty.innerHTML =
          `<div style="font-weight:900; color:var(--text); margin-bottom:6px;">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>
           <div>–ù–∞–∂–º–∏ –Ω–∞ –ª—é–±–æ–π —Å–µ–∫—Ç–æ—Ä –Ω–∞ —Å—Ñ–µ—Ä–µ –∏ —Å–¥–µ–ª–∞–π –ø–µ—Ä–≤—É—é –∑–∞–ø–∏—Å—å. –í—Å–µ –∑–∞–ø–∏—Å–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ –∏ –æ—Å—Ç–∞—é—Ç—Å—è —Å —Ç–æ–±–æ–π.</div>`;
        journalBody.appendChild(empty);
        return;
      }

      const pinned = entries.filter(e => e.pinned).sort((a,b) => a.createdAt < b.createdAt ? 1 : -1);
      const normal = entries.filter(e => !e.pinned).sort((a,b) => a.createdAt < b.createdAt ? 1 : -1);
      const sorted = [...pinned, ...normal];

      for(const e of sorted){
        const block = document.createElement("div");
        block.className = "entry";

        const dt = new Date(e.createdAt);
        const when = dt.toLocaleString();

        const pct = Math.max(0, Math.min(100, Number(e.progress || 0)));
        const pctColor = progressColor(pct);

        block.innerHTML = `
          <div class="entryTop">
            <div class="entryTag" title="${e.segmentName}">
                <span style="font-size:16px">${e.segmentEmoji}</span>
                </div>

            <div class="entryRight">
              <div class="progressPill" style="border-color:${pctColor}33;">
                <span style="color:${pctColor};">${pct}%</span>
              </div>
              <button class="miniBtn noSelect progressBtn" title="–ü—Ä–æ–≥—Ä–µ—Å—Å">üìà</button>
              <button class="miniBtn noSelect pinBtn ${e.pinned ? "pinned":""}" title="–ó–∞–∫—Ä–µ–ø–∏—Ç—å">üìå</button>
              <button class="miniBtn noSelect delBtn" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
              <span class="entryDate">${when}</span>

            </div>
          </div>
          <div class="entryText"></div>
          <div class="pop" style="display:${openProgressForId === e.id ? "block" : "none"};">
            <div class="popTop">
              <div>–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
              <div class="popVal"><span style="color:${pctColor};">${pct}%</span></div>
            </div>
            <div class="rangeWrap">
              <input type="range" min="0" max="100" step="1" value="${pct}" data-open="${openProgressForId === e.id ? "1":"0"}">
            </div>
          </div>
        `;

        const textEl = block.querySelector(".entryText");
        textEl.innerHTML = e.html;

        const pinBtn = block.querySelector(".pinBtn");
        const progBtn = block.querySelector(".progressBtn");
        const delBtn  = block.querySelector(".delBtn");
        const range   = block.querySelector('input[type="range"]');

        pinBtn.addEventListener("click", () => togglePin(e.id));
        progBtn.addEventListener("click", () => toggleProgressMenu(e.id));
        delBtn.addEventListener("click", () => deleteEntry(e.id));

        if(range){
          setRangeGradient(range, pct);

          range.addEventListener("input", () => {
            const v = Number(range.value);
            setRangeGradient(range, v);

            const valEl = block.querySelector(".popVal");
            const pill  = block.querySelector(".progressPill");
            const c = progressColor(v);

            valEl.innerHTML = `<span style="color:${c};">${v}%</span>`;
            pill.innerHTML  = `<span style="color:${c};">${v}%</span>`;
            pill.style.borderColor = `${c}33`;
          });

          range.addEventListener("change", () => {
            const v = Number(range.value);
            setProgress(e.id, v);
          });
        }

        journalBody.appendChild(block);
      }
    }

    // --------- Onboarding ----------
    function showOnboarding(){
      onbModalBg.classList.add("show");
    }
    function closeOnboarding(){
      onbModalBg.classList.remove("show");
    }

    // --------- Events ----------
    themeBtn.addEventListener("click", toggleTheme);

    sphereWrap.addEventListener("pointerdown", (e) => { dragging = true; lastX = e.clientX; });
    window.addEventListener("pointermove", (e) => {
      if(!dragging) return;
      const dx = e.clientX - lastX;
      rotY += dx * 0.22;
      lastX = e.clientX;
      layoutSphere();
    });
    window.addEventListener("pointerup", () => { dragging = false; });

    entryClose.addEventListener("click", closeEntry);
    entryModalBg.addEventListener("click", (e) => { if(e.target === entryModalBg) closeEntry(); });
    saveEntryBtn.addEventListener("click", saveEntry);

    openJournalBtn.addEventListener("click", openJournal);
    journalClose.addEventListener("click", closeJournal);
    journalModalBg.addEventListener("click", (e) => { if(e.target === journalModalBg) closeJournal(); });

    tbBold.addEventListener("click", () => execCmd("bold"));
    tbItalic.addEventListener("click", () => execCmd("italic"));
    tbList.addEventListener("click", () => execCmd("insertUnorderedList"));
    tbUndo.addEventListener("click", () => execCmd("undo"));
    tbColor.addEventListener("click", () => toggleAccentColor());

    editor.addEventListener("keyup", updateToolbarState);
    editor.addEventListener("mouseup", updateToolbarState);
    editor.addEventListener("focus", updateToolbarState);

    onbContinue.addEventListener("click", closeOnboarding);
    onbModalBg.addEventListener("click", (e) => { if(e.target === onbModalBg) closeOnboarding(); });

    // Prevent pinch zoom on iOS Safari (extra)
    document.addEventListener("gesturestart", (e) => e.preventDefault());
    document.addEventListener("gesturechange", (e) => e.preventDefault());
    document.addEventListener("gestureend", (e) => e.preventDefault());

    // Resize
    const ro = new ResizeObserver(() => layoutSphere());

    // Auto rotation
    function tick(){
      raf = requestAnimationFrame(tick);
      if(!dragging){
        rotY += 0.12;
        layoutSphere();
      }
    }

    function setVh(){
  document.documentElement.style.setProperty("--vh", (window.innerHeight * 0.01) + "px");
}
setVh();
window.addEventListener("resize", setVh);
window.addEventListener("orientationchange", setVh);


    // --------- Boot ----------
    initTheme();
    renderMetrics();
    buildSphere();
    ro.observe(sphereWrap);
    tick();

    // Always show onboarding on app open
    showOnboarding();
  </script>
</body>
</html>
