<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />

  <!-- iOS: fullscreen (–Ω–∞ —ç–∫—Ä–∞–Ω –¥–æ–º–æ–π) -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="@mind" />

  <!-- –¶–≤–µ—Ç —Å—Ç—Ä–æ–∫–∏ —Å—Ç–∞—Ç—É—Å–∞/–±—Ä–∞—É–∑–µ—Ä–∞ -->
  <meta name="theme-color" content="#050816" media="(prefers-color-scheme: dark)" />
  <meta name="theme-color" content="#f6f7fb" media="(prefers-color-scheme: light)" />

  <!-- –ò–∫–æ–Ω–∫–∏ -->
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon-v3.png" />
  <link rel="icon" type="image/png" sizes="192x192" href="logo-192-v3.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="logo-192-v3.png" />

  <!-- manifest (Android/Chrome) -->
  <link rel="manifest" href="manifest.webmanifest" />

  <title>@mind</title>

  <style>
    :root{
      --bg:#f6f7fb;
      --bg2:#ffffff;
      --text:#0b1220;
      --muted:rgba(11,18,32,.55);
      --card:rgba(255,255,255,.78);
      --card2:rgba(255,255,255,.62);
      --border:rgba(11,18,32,.12);
      --border2:rgba(109,94,252,.22);
      --accent:#6d5efc;
      --accent2:#a78bfa;
      --shadow: 0 12px 34px rgba(2,6,23,.12);
      --shadow2: 0 18px 50px rgba(109,94,252,.28);
      --radius:22px;

      /* –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≤—ã—Å–æ—Ç–∞ –Ω–∏–∂–Ω–µ–π –ø–∞–Ω–µ–ª–∏ ‚Äî –∑–∞–¥–∞—ë—Ç—Å—è –∏–∑ JS */
      --bottomBarH: 92px;
    }

    [data-theme="dark"]{
      --bg:#050816;
      --bg2:#070a1a;

      --text:#e9ecf3;
      --muted:rgba(233,236,243,.62);
      --card:rgba(7,10,26,.74);
      --card2:rgba(7,10,26,.62);

      --border:rgba(233,236,243,.14);
      --border2:rgba(167,139,250,.28);
    }

    *{ box-sizing:border-box; -webkit-tap-highlight-color: transparent; }

    html, body {
      height: 100%;
      min-height: 100%;
      margin: 0;
      background: var(--bg);
    }

    body {
      background-color: var(--bg);
      overflow: hidden;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      color: var(--text);
      touch-action: manipulation;
    }

    /* —Ñ–æ–Ω –≤—Å–µ–≥–¥–∞ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω */
    body::before{
      content:"";
      position: fixed;
      inset: 0;
      z-index: -1;
      background:
        radial-gradient(900px 700px at 20% 10%, rgba(109,94,252,.18), transparent 60%),
        radial-gradient(900px 700px at 80% 30%, rgba(167,139,250,.16), transparent 60%),
        radial-gradient(900px 700px at 60% 92%, rgba(109,94,252,.10), transparent 70%),
        linear-gradient(180deg, var(--bg), var(--bg2));
    }

    .app{
      height: calc(var(--vh, 1vh) * 100);
      display:flex;
      flex-direction:column;
    }

    .top{
      padding-left: 16px;
      padding-right: 16px;
      padding-bottom: 10px;
      padding-top: calc(16px + env(safe-area-inset-top));
    }

    .header{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .brand{ display:flex; flex-direction:column; gap:2px; }
    .h-title{ font-weight:900; font-size:18px; letter-spacing:.2px; color:var(--text); }
    .h-sub{ font-size:12px; color:var(--muted); }

    .iconBtn{
      width:44px;height:44px;border-radius:16px;
      border:1px solid var(--border);
      background:var(--card);
      box-shadow:var(--shadow);
      backdrop-filter: blur(12px);
      cursor:pointer;
      color:var(--text);
      display:flex;align-items:center;justify-content:center;
      user-select:none;
    }

    .metrics{ display:flex; gap:10px; margin-top:12px; }
    .metric{
      flex:1;min-width:0;
      background:var(--card);
      border:1px solid var(--border);
      border-radius:16px;
      padding:10px 12px;
      box-shadow:var(--shadow);
      backdrop-filter: blur(12px);
    }
    .metric .k{ font-size:11px; color:var(--muted); }
    .metric .v{ margin-top:2px; font-size:16px; font-weight:900; color:var(--text); }

    .main{
      flex: 1 1 auto;
      display:flex;
      flex-direction:column;
      align-items:center;

      /* –í–∞–∂–Ω–æ: –Ω–µ –¥–µ—Ä–∂–∏–º —Å—Ñ–µ—Ä—É —Å—Ç—Ä–æ–≥–æ –ø–æ —Ü–µ–Ω—Ç—Ä—É —Å –æ–≥—Ä–æ–º–Ω—ã–º "–Ω–∏–∑–æ–º".
         –†–µ–∞–ª—å–Ω–æ –º–µ—Å—Ç–æ —Å–Ω–∏–∑—É –∑–∞–Ω–∏–º–∞–µ—Ç bottomBar, –ø–æ—ç—Ç–æ–º—É padding-bottom –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π. */
      justify-content:center;

      padding: 0 16px;
      overflow:hidden;

      /* –≤–º–µ—Å—Ç–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö 110px ‚Äî —Ä–µ–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ bottomBar */
      padding-bottom: calc(var(--bottomBarH) + env(safe-area-inset-bottom));
    }

    .sphereSection{
      width:100%;
      max-width:430px;

      flex: 0 0 auto;

      display:flex;
      align-items:center;
      justify-content:center;

      padding-bottom: 8px;
    }

    .sphereWrap{
      position:relative;
      width: min(420px, 92vw);
      aspect-ratio: 1 / 1;
      border-radius: 28px;
      overflow: hidden;
      background:
        radial-gradient(closest-side at 50% 44%, rgba(109,94,252,.14), transparent 68%),
        radial-gradient(closest-side at 60% 60%, rgba(167,139,250,.10), transparent 70%);
      touch-action:none; /* –∫–ª—é—á –¥–ª—è webview */
    }

    .softGlow{
      position:absolute; inset:-40px;
      background: radial-gradient(closest-side, rgba(167,139,250,.18), transparent 70%);
      filter: blur(18px);
      opacity:.75;
      pointer-events:none;
      animation: breathe 4.6s ease-in-out infinite;
    }
    @keyframes breathe{ 0%,100%{ transform: scale(1); } 50%{ transform: scale(1.06); } }

    .sphere{ position:absolute; inset:0; transform-style:preserve-3d; will-change:transform; }
    .node{ position:absolute; left:50%; top:50%; transform-style:preserve-3d; will-change:transform; }

    .chip{
      display:flex; align-items:center; gap:8px;
      padding: 9px 12px;
      border-radius: 18px;
      border: 1px solid var(--border2);
      background: var(--card2);
      backdrop-filter: blur(14px);
      box-shadow: 0 10px 26px rgba(2,6,23,.10);
      color:var(--text);
      font-size:12px;
      font-weight:900;
      white-space:nowrap;
      cursor:pointer;
      user-select:none;
      transition: transform .12s ease, opacity .12s ease, filter .12s ease;
      /* —á—É—Ç—å —á–µ—Ç—á–µ –Ω–∞ –º–æ–±–∏–ª–∫–∞—Ö */
      -webkit-font-smoothing: antialiased;
      text-rendering: geometricPrecision;
    }
    .chip:active{ transform: scale(.98); }
    .chip .e{ font-size:16px; }

    .bottomBar{
      position:fixed;
      left:0; right:0;
      bottom:0;
      padding: 10px 16px calc(14px + env(safe-area-inset-bottom));
      background: linear-gradient(180deg, rgba(255,255,255,0), var(--card));
      backdrop-filter: blur(14px);
      border-top: 1px solid var(--border);
      display:flex;
      justify-content:center;
      z-index:20;
    }
    [data-theme="dark"] .bottomBar{
      background: linear-gradient(180deg, rgba(0,0,0,0), var(--card));
    }

    .bottomStack{
      width: min(430px, 100%);
      display:flex;
      flex-direction:column;
      gap:10px;
    }

    .primaryBtn{
      width: 100%;
      height: 52px;
      border-radius: 999px;
      border: 1px solid rgba(109,94,252,.25);
      background: linear-gradient(135deg, rgba(109,94,252,.95), rgba(167,139,250,.85));
      color:#fff;
      font-weight: 950;
      letter-spacing:.2px;
      box-shadow: var(--shadow2);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      user-select:none;
    }

    .secondaryBtn{
      width:100%;
      height: 44px;
      border-radius: 999px;
      border: 1px solid rgba(109,94,252,.18);
      background: linear-gradient(135deg, rgba(255,255,255,.72), rgba(255,255,255,.52));
      color: var(--text);
      font-weight: 950;
      letter-spacing:.15px;
      box-shadow: 0 14px 42px rgba(2,6,23,.10);
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      user-select:none;
      backdrop-filter: blur(14px);
    }
    [data-theme="dark"] .secondaryBtn{
      background: linear-gradient(135deg, rgba(7,10,26,.70), rgba(7,10,26,.52));
      border-color: rgba(167,139,250,.20);
      box-shadow: 0 18px 55px rgba(0,0,0,.40);
      color: var(--text);
    }

    .modalBg{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.42);
      display:none;
      align-items:flex-end;
      justify-content:center;
      padding: 10px 10px calc(10px + env(safe-area-inset-bottom));
      backdrop-filter: blur(10px);
      z-index:50;
    }
    .modalBg.show{ display:flex; }

    .modal{
      width: min(560px, 100%);
      background: var(--card);
      border:1px solid var(--border);
      border-radius: 26px;
      box-shadow: var(--shadow);
      padding: 14px;
      backdrop-filter: blur(14px);
      max-height: 86vh;
      overflow:auto;
      padding-bottom: calc(14px + env(safe-area-inset-bottom));
    }

    .modalTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .modalTitle{ font-weight: 950; font-size: 14px; color: var(--text); }
    .modalHint{
      margin-top:6px;
      font-size: 12px;
      color: var(--muted);
      line-height:1.35;
    }

    .editor{
      margin-top:12px;
      min-height: 220px;
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 12px;
      outline:none;
      background: transparent;
      color: var(--text);
      font-size: 15px;
      line-height: 1.4;
      overflow:auto;
      -webkit-user-select:text;
      user-select:text;
    }
    .editor:empty:before{ content: attr(data-placeholder); color: var(--muted); }

    .saveBtn{
      margin-top:12px;
      width: 100%;
      height: 48px;
      border-radius: 18px;
      border: 1px solid rgba(109,94,252,.25);
      background: linear-gradient(135deg, rgba(109,94,252,.95), rgba(167,139,250,.80));
      color:#fff;
      font-weight: 950;
      cursor:pointer;
    }

    .journalHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .journalTitle{ font-weight: 950; font-size: 14px; color: var(--text); }

    /* –§–∏–ª—å—Ç—Ä –¥–Ω–µ–≤–Ω–∏–∫–∞ */
    .journalRight{
      display:flex;
      align-items:center;
      gap:10px;
    }
    .filterSelect{
      height: 40px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: var(--card);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      color: var(--text);
      font-weight: 900;
      font-size: 12px;
      padding: 0 10px;
      outline: none;
      max-width: 220px;
      cursor: pointer;
    }
    .filterSelect option{
      color: #111;
    }
    [data-theme="dark"] .filterSelect option{
      color: #111; /* options –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ –±—Ä–∞—É–∑–µ—Ä–æ–≤ —Å–∏—Å—Ç–µ–º–Ω—ã–µ */
    }

    .emptyBox{
      margin-top:10px;
      border:1px dashed var(--border);
      border-radius: 18px;
      padding: 12px;
      color: var(--muted);
      font-size: 13px;
      line-height:1.35;
      background: rgba(255,255,255,.03);
    }

    .entry{
      border:1px solid var(--border);
      background: rgba(255,255,255,.02);
      border-radius: 18px;
      padding: 12px;
      margin-top: 10px;
      position:relative;
    }

    .entryTop{
      display:grid;
      grid-template-columns: 1fr auto;
      align-items:start;
      gap:10px;
      font-size:12px;
      color: var(--muted);
    }

    .entryTag{
      display:flex;
      align-items:center;
      gap:8px;
      font-weight:900;
      color: var(--text);
      min-width:0;
      overflow:hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
      align-items: center;
      min-height: 28px;
    }

    .segEmoji{
      width: 22px;
      height: 22px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      line-height: 1;
      flex: 0 0 22px;
    }

    .entryRight{
      display:grid;
      grid-auto-flow: column;
      grid-auto-columns: max-content;
      align-items:center;
      gap:8px;
    }

    .entryDate{
      font-size:11px;
      color: var(--muted);
      margin-left: 6px;
      white-space: nowrap;
    }

    .progressPill{
      padding: 5px 8px;
      border-radius: 999px;
      border:1px solid var(--border);
      background: rgba(255,255,255,.03);
      font-weight: 900;
      font-size: 11px;
      min-width: 56px;
      text-align:center;
      user-select:none;
    }

    .miniBtn{
      width:32px;
      height:32px;
      border-radius:12px;
      border:1px solid var(--border);
      background:transparent;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .pinBtn.pinned{
      background: rgba(109,94,252,.14);
      border-color: rgba(109,94,252,.24);
    }

    .entryText{
      margin-top:8px;
      font-size: 14px;
      line-height: 1.4;
      color: var(--text);
      overflow-wrap: anywhere;
    }

    .pop{
      margin-top:10px;
      border:1px solid var(--border);
      border-radius: 16px;
      padding: 12px;
      background: rgba(255,255,255,.04);
    }
    .popTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      font-size:12px;
      color: var(--muted);
    }
    .popVal{ font-weight: 950; color: var(--text); }

    .rangeWrap{ margin-top:10px; }

    input[type="range"]{
      -webkit-appearance:none;
      width:100%;
      height: 10px;
      border-radius: 999px;
      background: rgba(11,18,32,.10);
      outline:none;
    }
    [data-theme="dark"] input[type="range"]{
      background: rgba(233,236,243,.12);
    }

    input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance:none;
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: var(--accent);
      border: 2px solid rgba(255,255,255,.85);
      box-shadow: 0 10px 22px rgba(2,6,23,.20);
      cursor:pointer;
    }
    input[type="range"]::-moz-range-thumb{
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: var(--accent);
      border: 2px solid rgba(255,255,255,.85);
      box-shadow: 0 10px 22px rgba(2,6,23,.20);
      cursor:pointer;
    }

    /* Affirmations */
    .affTopRow{
      display:flex;
      gap:10px;
      margin-top:10px;
    }
    .affInput{
      flex:1;
      min-height: 44px;
      max-height: 120px;
      border:1px solid var(--border);
      border-radius: 16px;
      padding: 10px 12px;
      background: transparent;
      color: var(--text);
      font-size: 14px;
      line-height: 1.35;
      outline:none;
      resize:none;
    }
    .affAddBtn{
      width: 52px;
      height: 52px;
      border-radius: 16px;
      border: 1px solid rgba(109,94,252,.25);
      background: linear-gradient(135deg, rgba(109,94,252,.95), rgba(167,139,250,.80));
      color:#fff;
      font-weight: 950;
      cursor:pointer;
      box-shadow: var(--shadow2);
      display:flex;
      align-items:center;
      justify-content:center;
      user-select:none;
    }

    .noSelect{
      user-select:none;
      -webkit-user-select:none;
    }

    @media (max-width: 420px){
      .h-title{ font-size: 17px; }
      .h-sub{ font-size: 11px; }
      .metric .v{ font-size: 15px; }
      .chip{ font-size: 11px; padding: 8px 10px; border-radius: 16px; }
      .chip .e{ font-size: 15px; }
      .entryText{ font-size: 13px; line-height: 1.35; }
      .modal{ border-radius: 22px; padding: 12px; padding-bottom: calc(12px + env(safe-area-inset-bottom)); }
      .secondaryBtn{ height: 42px; }
      .primaryBtn{ height: 50px; }
      .filterSelect{ max-width: 160px; }
    }
  </style>
</head>

<body>
  <div class="app">
    <div class="top">
      <div class="header">
        <div class="brand">
          <div class="h-title">@mind</div>
          <div class="h-sub">–î–Ω–µ–≤–Ω–∏–∫ —Å–∞–º–æ–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.</div>
        </div>
        <button class="iconBtn noSelect" id="themeBtn" aria-label="–¢–µ–º–∞" title="–¢–µ–º–∞">üåì</button>
      </div>

      <div class="metrics">
        <div class="metric">
          <div class="k">–°–µ—Ä–∏—è –¥–Ω–µ–π</div>
          <div class="v" id="mStreak">0 üî•</div>
        </div>
        <div class="metric">
          <div class="k">–°–µ–≥–æ–¥–Ω—è</div>
          <div class="v" id="mToday">0 üìù</div>
        </div>
      </div>
    </div>

    <div class="main">
      <div class="sphereSection">
        <div class="sphereWrap" id="sphereWrap">
          <div class="softGlow"></div>
          <div class="sphere" id="sphere"></div>
        </div>
      </div>
    </div>

    <div class="bottomBar" id="bottomBar">
      <div class="bottomStack">
        <button class="secondaryBtn noSelect" id="openAffBtn">
          <span style="font-size:16px">üìö</span>
          <span>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∞—Ñ—Ñ–∏—Ä–º–∞—Ü–∏–π</span>
        </button>

        <button class="primaryBtn noSelect" id="openJournalBtn">
          <span style="font-size:18px">üìì</span>
          <span>–û—Ç–∫—Ä—ã—Ç—å –¥–Ω–µ–≤–Ω–∏–∫</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Entry editor modal -->
  <div class="modalBg" id="entryModalBg">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modalTop">
        <div class="modalTitle" id="entryTitle">üìù –ó–∞–ø–∏—Å—å</div>
        <button class="iconBtn noSelect" id="entryClose" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>
      <div class="modalHint" id="entryHint"></div>

      <div class="editor" id="editor" contenteditable="true"
        data-placeholder="–ü–∏—à–∏ –∫–∞–∫ –≤ –ª–∏—á–Ω—ã–π –¥–Ω–µ–≤–Ω–∏–∫. –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –±—ã—Ç—å –Ω–∞—Å—Ç–æ—è—â–∏–º."></div>

      <button class="saveBtn noSelect" id="saveEntryBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>

  <!-- Journal modal -->
  <div class="modalBg" id="journalModalBg">
    <div class="modal" id="journalModal" role="dialog" aria-modal="true">
      <div class="journalHeader">
        <div class="journalTitle">üìì –î–Ω–µ–≤–Ω–∏–∫</div>

        <div class="journalRight">
          <select class="filterSelect" id="journalFilter" aria-label="–§–∏–ª—å—Ç—Ä –∑–∞–ø–∏—Å–µ–π">
            <option value="">–í—Å–µ –∑–∞–ø–∏—Å–∏</option>
          </select>

          <button class="iconBtn noSelect" id="journalClose" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
        </div>
      </div>

      <div id="journalBody"></div>
    </div>
  </div>

  <!-- Affirmations modal -->
  <div class="modalBg" id="affModalBg">
    <div class="modal" id="affModal" role="dialog" aria-modal="true">
      <div class="journalHeader">
        <div class="journalTitle">üìö –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∞—Ñ—Ñ–∏—Ä–º–∞—Ü–∏–π</div>
        <button class="iconBtn noSelect" id="affClose" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>

      <div class="modalHint">–î–æ–±–∞–≤–ª—è–π —Ñ—Ä–∞–∑—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ö–æ—á–µ—à—å –ø–æ–≤—Ç–æ—Ä—è—Ç—å.</div>

      <div class="affTopRow">
        <textarea class="affInput" id="affInput" rows="2" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –Ø –≤—ã–±–∏—Ä–∞—é –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å–ø–æ–∫–æ–π–Ω–æ –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ."></textarea>
        <button class="affAddBtn noSelect" id="affAddBtn" title="–î–æ–±–∞–≤–∏—Ç—å">Ôºã</button>
      </div>

      <div id="affBody"></div>
    </div>
  </div>

  <script>
    // --------- Data ----------
    const segments = [
      { id: 1,  name: "–ú—ã—Å–ª–∏",           emoji: "üí≠" },
      { id: 2,  name: "–ß—É–≤—Å—Ç–≤–∞",         emoji: "üòî" },
      { id: 3,  name: "–°–∞–º–æ–æ—Ü–µ–Ω–∫–∞",      emoji: "‚ú®" },
      { id: 4,  name: "–ú—ã—à–ª–µ–Ω–∏–µ",        emoji: "üß†" },
      { id: 5,  name: "–¢—Ä–µ–≤–æ–≥–∞",         emoji: "üåô" },
      { id: 6,  name: "–ú–æ—Ç–∏–≤–∞—Ü–∏—è",       emoji: "üî•" },
      { id: 7,  name: "–†–æ—Å—Ç",            emoji: "ü¶ã" },
      { id: 8,  name: "–ò–Ω—Ç—É–∏—Ü–∏—è",        emoji: "üßø" },
      { id: 9,  name: "–°—Ç—Ä–∞—Ö–∏",          emoji: "üíî" },
      { id: 10, name: "–õ—é–±–æ–≤—å –∫ —Å–µ–±–µ",   emoji: "üíñ" },
      { id: 11, name: "–≠–Ω–µ—Ä–≥–∏—è",         emoji: "üõå" },
      { id: 12, name: "–ú–µ—á—Ç–∞",           emoji: "üíº" },
      { id: 13, name: "–î–µ–Ω—å–≥–∏",          emoji: "üí∏" },
      { id: 14, name: "–ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å",   emoji: "üå∏" },
      { id: 15, name: "–Ø—Å–Ω–æ—Å—Ç—å",         emoji: "üß©" },
      { id: 16, name: "–≠–º–æ—Ü–∏–∏",          emoji: "üåä" },
      { id: 17, name: "–í–∏–¥–µ–Ω–∏–µ",         emoji: "üîÆ" },
      { id: 18, name: "–°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ",     emoji: "üïä" },
      { id: 19, name: "–°–∏–ª–∞",            emoji: "‚ö°Ô∏è" },
      { id: 20, name: "–°–≤–æ–±–æ–¥–Ω—ã–π —Ç–µ–∫—Å—Ç", emoji: "üìù" },
    ];

    const hintsBySegment = {
      1: [
        "–ö–∞–∫–∞—è –º—ã—Å–ª—å —Å–µ–π—á–∞—Å —É–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–≤–æ–∏–º –¥–Ω—ë–º ‚Äî –∏ –ø–æ–¥—Ö–æ–¥–∏—Ç –ª–∏ –æ–Ω–∞ —Ç–µ–±–µ?",
        "–ï—Å–ª–∏ –±—ã —Ç—ã –¥—É–º–∞–ª –º—è–≥—á–µ, –∫–∞–∫ –±—ã –∑–≤—É—á–∞–ª–∞ —ç—Ç–∞ –º—ã—Å–ª—å?",
        "–û–¥–Ω–∞ –Ω–æ–≤–∞—è –º—ã—Å–ª—å, –∫–æ—Ç–æ—Ä–∞—è –¥–µ–ª–∞–µ—Ç —Ç–µ–±—è —Å–ø–æ–∫–æ–π–Ω–µ–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.",
        "–ß—Ç–æ —Ç—ã —Ä–µ—à–∞–µ—à—å —Å—á–∏—Ç–∞—Ç—å –ø—Ä–∞–≤–¥–æ–π –æ —Å–µ–±–µ —Å–µ–≥–æ–¥–Ω—è?",
        "–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –º—ã—Å–ª—å —Ç–∞–∫, –∫–∞–∫ –±—É–¥—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—à—å —Å–µ–±—è."
      ],
      2: [
        "–ß—Ç–æ —Ç—ã —á—É–≤—Å—Ç–≤—É–µ—à—å —Ç–µ–ª–æ–º –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å? –ù–∞–∑–æ–≤–∏ —ç—Ç–æ —Ç–æ—á–Ω–æ.",
        "–ö–∞–∫–∞—è —ç–º–æ—Ü–∏—è –ø—Ä–æ—Å–∏—Ç –≤–Ω–∏–º–∞–Ω–∏—è, –∞ –Ω–µ –±–æ—Ä—å–±—ã?",
        "–ï—Å–ª–∏ —ç–º–æ—Ü–∏—è –º–æ–≥–ª–∞ –±—ã –≥–æ–≤–æ—Ä–∏—Ç—å ‚Äî —á—Ç–æ –±—ã –æ–Ω–∞ —Å–∫–∞–∑–∞–ª–∞?",
        "–ß—Ç–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –æ–±–ª–µ–≥—á–µ–Ω–∏–µ –Ω–∞ 10%?",
        "–ö–∞–∫–æ–µ —á—É–≤—Å—Ç–≤–æ —Ç—ã –≤—ã–±–∏—Ä–∞–µ—à—å –±–µ—Ä–µ–∂–Ω–æ –ø—Ä–æ–∂–∏—Ç—å —Å–µ–≥–æ–¥–Ω—è?"
      ],
      3: [
        "–ó–∞ —á—Ç–æ —Ç—ã –º–æ–∂–µ—à—å —É–≤–∞–∂–∞—Ç—å —Å–µ–±—è —É–∂–µ —Å–µ–π—á–∞—Å?",
        "–ö–∞–∫–∞—è –º–∞–ª–µ–Ω—å–∫–∞—è –ø–æ–±–µ–¥–∞ —Å–µ–≥–æ–¥–Ω—è –±—ã–ª–∞ –Ω–∞—Å—Ç–æ—è—â–µ–π?",
        "–ö–∞–∫ –±—ã –∑–≤—É—á–∞–ª–∞ —Ç–≤–æ—è —Å–∞–º–æ–æ—Ü–µ–Ω–∫–∞ –±–µ–∑ –∫—Ä–∏—Ç–∏–∫–∞?",
        "–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –æ–¥–Ω–æ –∫–∞—á–µ—Å—Ç–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ –≤ —Ç–µ–±–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ —Å–∏–ª—å–Ω–æ–µ.",
        "–ß—Ç–æ —Ç—ã –≤—ã–±–∏—Ä–∞–µ—à—å —Ü–µ–Ω–∏—Ç—å –≤ —Å–µ–±–µ —Å–µ–≥–æ–¥–Ω—è?"
      ],
      4: [
        "–ö–∞–∫–æ–π —Å—Ç–∞—Ä—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π —Ç—ã –≥–æ—Ç–æ–≤ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–æ–≤—ã–º –ø—Ä–∞–≤–∏–ª–æ–º?",
        "–ö–∞–∫–æ–µ —É–±–µ–∂–¥–µ–Ω–∏–µ —Ç—ã –≤—ã–±–∏—Ä–∞–µ—à—å —É—Å–∏–ª–∏—Ç—å –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ?",
        "–ö–∞–∫–∞—è –º—ã—Å–ª—å –¥–µ–ª–∞–µ—Ç —Ç–µ–±—è —Å–∏–ª—å–Ω–µ–µ –≤ –±–ª–∏–∂–∞–π—à–∏–µ 24 —á–∞—Å–∞?",
        "–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —É—Å—Ç–∞–Ω–æ–≤–∫—É –≤ –æ–¥–Ω–æ–º –∫–æ—Ä–æ—Ç–∫–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏.",
        "–ö–∞–∫ –±—ã –∑–≤—É—á–∞–ª–æ –º—ã—à–ª–µ–Ω–∏–µ —á–µ–ª–æ–≤–µ–∫–∞, –∫–æ—Ç–æ—Ä—ã–º —Ç—ã —Å—Ç–∞–Ω–æ–≤–∏—à—å—Å—è?"
      ],
      5: [
        "–ß—Ç–æ –∏–º–µ–Ω–Ω–æ —Ç—Ä–µ–≤–æ–∂–∏—Ç: —Ñ–∞–∫—Ç, –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç—å –∏–ª–∏ –æ–∂–∏–¥–∞–Ω–∏—è?",
        "–ù–∞–∑–æ–≤–∏ —Å–∞–º—ã–π –º–∞–ª–µ–Ω—å–∫–∏–π —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥, –∫–æ—Ç–æ—Ä—ã–π —Å–Ω–∏–∂–∞–µ—Ç —Ç—Ä–µ–≤–æ–≥—É.",
        "–ö–∞–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–∞—è –º—ã—Å–ª—å —É—Å–ø–æ–∫–∞–∏–≤–∞–µ—Ç –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å?",
        "–ß—Ç–æ —Ç—ã –º–æ–∂–µ—à—å –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Å–µ–≥–æ–¥–Ω—è, –∞ —á—Ç–æ ‚Äî –æ—Ç–ø—É—Å—Ç–∏—Ç—å?",
        "–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π —Ñ—Ä–∞–∑—É: ¬´–î–∞–∂–µ –µ—Å–ª–∏‚Ä¶, —è –≤—Å—ë —Ä–∞–≤–Ω–æ‚Ä¶¬ª"
      ],
      6: [
        "–ö–∞–∫–∞—è —Ü–µ–ª—å —Å–µ–≥–æ–¥–Ω—è –≤–∞–∂–Ω–µ–µ –≤—Å–µ–≥–æ –Ω–∞ 1%?",
        "–ö–∞–∫–æ–π –æ–¥–∏–Ω —à–∞–≥ –¥–∞—Å—Ç –æ—â—É—â–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —É–∂–µ —Å–µ–≥–æ–¥–Ω—è?",
        "–ß—Ç–æ —Ç—ã —Å–¥–µ–ª–∞–µ—à—å, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è?",
        "–ù–∞–∑–æ–≤–∏ –¥–µ–π—Å—Ç–≤–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç –º–µ—á—Ç—É –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å.",
        "–ö–∞–∫ —Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∏—à—å —Å–≤–æ—é –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É –º—è–≥–∫–æ, –±–µ–∑ –¥–∞–≤–ª–µ–Ω–∏—è?"
      ],
      7: [
        "–í —á—ë–º —Ç—ã —Å—Ç–∞–ª –ª—É—á—à–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–µ—Å—è—Ü?",
        "–ö–∞–∫–∞—è –ø—Ä–∏–≤—ã—á–∫–∞ –¥–∞—ë—Ç —Ä–æ—Å—Ç –±—ã—Å—Ç—Ä–µ–µ –≤—Å–µ–≥–æ?",
        "–ß—Ç–æ —Ç—ã –≤—ã–±–∏—Ä–∞–µ—à—å —É–ª—É—á—à–∞—Ç—å –±–µ–∑ —Å–ø–µ—à–∫–∏, –Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ?",
        "–û–¥–∏–Ω –Ω–∞–≤—ã–∫, –∫–æ—Ç–æ—Ä—ã–π —Å—Ç–æ–∏—Ç —É—Å–∏–ª–∏—Ç—å –Ω–∞ —ç—Ç–æ–π –Ω–µ–¥–µ–ª–µ.",
        "–ö–∞–∫–æ–π —Ä–æ—Å—Ç —Ç—ã —É–≤–∏–¥–∏—à—å —á–µ—Ä–µ–∑ 30 –¥–Ω–µ–π, –µ—Å–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—à—å?"
      ],
      8: [
        "–ö–∞–∫–æ–µ —Ç–∏—Ö–æ–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –∑–Ω–∞–Ω–∏–µ —Ç—ã –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–ª?",
        "–ï—Å–ª–∏ –±—ã –∏–Ω—Ç—É–∏—Ü–∏—è –¥–∞–≤–∞–ª–∞ —Å–æ–≤–µ—Ç ‚Äî –∫–∞–∫–æ–π?",
        "–ß—Ç–æ –∫–∞–∂–µ—Ç—Å—è ¬´–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º¬ª, –¥–∞–∂–µ –µ—Å–ª–∏ —Å—Ç—Ä–∞—à–Ω–æ?",
        "–ö–∞–∫–∞—è –∏–¥–µ—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å–Ω–æ–≤–∞ –∏ —Å–Ω–æ–≤–∞ ‚Äî –∏ –ø–æ—á–µ–º—É?",
        "–ó–∞–ø–∏—à–∏ —Ä–µ—à–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –æ—â—É—â–∞–µ—Ç—Å—è —á–µ—Å—Ç–Ω—ã–º."
      ],
      9: [
        "–ö–∞–∫–æ–π —Å—Ç—Ä–∞—Ö –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –∑–∞—â–∏—â–∞–µ—Ç —Ç–µ–±—è?",
        "–ß—Ç–æ –±—É–¥–µ—Ç, –µ—Å–ª–∏ —Å–¥–µ–ª–∞—Ç—å —à–∞–≥ –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Å—Ç—Ä–∞—Ö?",
        "–ß–µ–≥–æ —Ç—ã –±–æ–∏—à—å—Å—è –ø–æ—Ç–µ—Ä—è—Ç—å ‚Äî –∏ —á—Ç–æ –º–æ–∂–µ—à—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å?",
        "–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π —Å—Ç—Ä–∞—Ö –æ–¥–Ω–æ–π —Ñ—Ä–∞–∑–æ–π. –ü–æ—Ç–æ–º ‚Äî –æ—Ç–≤–µ—Ç —Å–∏–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π —Å–µ–±—è.",
        "–ö–∞–∫–æ–π —Å—Ç—Ä–∞—Ö —Ç—ã –≥–æ—Ç–æ–≤ —É–º–µ–Ω—å—à–∏—Ç—å –Ω–∞ 1% —Å–µ–≥–æ–¥–Ω—è?"
      ],
      10: [
        "–ß—Ç–æ —Ç—ã –º–æ–∂–µ—à—å —Å–¥–µ–ª–∞—Ç—å –¥–ª—è —Å–µ–±—è —Å –∑–∞–±–æ—Ç–æ–π —Å–µ–≥–æ–¥–Ω—è?",
        "–ö–∞–∫–∞—è —Ñ—Ä–∞–∑–∞ –∑–≤—É—á–∏—Ç –∫–∞–∫ –ª—é–±–æ–≤—å –∫ —Å–µ–±–µ –±–µ–∑ –ø–∞—Ñ–æ—Å–∞?",
        "–ö–∞–∫ –±—ã —Ç—ã –ø–æ–¥–¥–µ—Ä–∂–∞–ª –±–ª–∏–∑–∫–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞ –≤ —Ç–∞–∫–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏?",
        "–û–¥–Ω–∞ –≤–µ—â—å, –∑–∞ –∫–æ—Ç–æ—Ä—É—é —Ç—ã –±–ª–∞–≥–æ–¥–∞—Ä–µ–Ω —Å–µ–±–µ.",
        "–ß—Ç–æ —Ç—ã –≤—ã–±–∏—Ä–∞–µ—à—å —É–≤–∞–∂–∞—Ç—å –≤ —Å–µ–±–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å?"
      ],
      11: [
        "–ß—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–±–µ —ç–Ω–µ—Ä–≥–∏—é –±—ã—Å—Ç—Ä–µ–µ –≤—Å–µ–≥–æ?",
        "–ö–∞–∫–∞—è –º–µ–ª–æ—á—å —Å–µ–≥–æ–¥–Ω—è —É–ª—É—á—à–∏—Ç —Å–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ?",
        "–ì–¥–µ —Ç—ã —Ç–µ—Ä—è–µ—à—å —ç–Ω–µ—Ä–≥–∏—é –∏ –∫–∞–∫ —Å–æ–∫—Ä–∞—Ç–∏—Ç—å –ø–æ—Ç–µ—Ä–∏?",
        "–ß—Ç–æ —Ç—ã –≤—ã–±–∏—Ä–∞–µ—à—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ–≥–æ–¥–Ω—è: —Å–æ–Ω, –ø–∏—Ç–∞–Ω–∏–µ, —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ?",
        "–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –ø–ª–∞–Ω –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ 12 —á–∞—Å–æ–≤."
      ],
      12: [
        "–ö–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –º–µ—á—Ç–∞ –≤ –æ–¥–Ω–æ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –∫–∞–¥—Ä–µ?",
        "–ö–∞–∫–∞—è —á–∞—Å—Ç—å –º–µ—á—Ç—ã —É–∂–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å–µ–≥–æ–¥–Ω—è?",
        "–ß—Ç–æ —Ç—ã –≥–æ—Ç–æ–≤ —Å–¥–µ–ª–∞—Ç—å —Ä–∞–¥–∏ –º–µ—á—Ç—ã –≤ –±–ª–∏–∂–∞–π—à–∏–µ 7 –¥–Ω–µ–π?",
        "–ó–∞–ø–∏—à–∏ —Ü–µ–ª—å —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω–∞ –≤–¥–æ—Ö–Ω–æ–≤–ª—è–ª–∞, –∞ –Ω–µ –¥–∞–≤–∏–ª–∞.",
        "–ö–∞–∫–æ–µ —á—É–≤—Å—Ç–≤–æ –±—É–¥–µ—Ç, –∫–æ–≥–¥–∞ –º–µ—á—Ç–∞ —Å—Ç–∞–Ω–µ—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é?"
      ],
      13: [
        "–ö–∞–∫–∞—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤–∞—è –ø—Ä–∏–≤—ã—á–∫–∞ –ø–æ–º–æ–∂–µ—Ç —Ç–µ–±–µ –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ?",
        "–ß—Ç–æ —Ç—ã –º–æ–∂–µ—à—å –º–æ–Ω–µ—Ç–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä—è–º–æ –∏–∑ —Ç–µ–∫—É—â–∏—Ö –Ω–∞–≤—ã–∫–æ–≤?",
        "–û–¥–∏–Ω —à–∞–≥ –∫ –¥–µ–Ω—å–≥–∞–º, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã —Å–¥–µ–ª–∞–µ—à—å —Å–µ–≥–æ–¥–Ω—è.",
        "–ö–∞–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ —É–ª—É—á—à–∏—Ç —Ç–≤–æ–π –¥–æ—Ö–æ–¥ –≤ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤–µ 30 –¥–Ω–µ–π?",
        "–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π —Å–ø–æ–∫–æ–π–Ω—É—é —É—Å—Ç–∞–Ω–æ–≤–∫—É –ø—Ä–æ –¥–µ–Ω—å–≥–∏ –±–µ–∑ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏—è."
      ],
      14: [
        "–¢—Ä–∏ –≤–µ—â–∏, –∑–∞ –∫–æ—Ç–æ—Ä—ã–µ —Ç—ã –±–ª–∞–≥–æ–¥–∞—Ä–µ–Ω –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.",
        "–ß—Ç–æ —Ö–æ—Ä–æ—à–µ–≥–æ —É–∂–µ –µ—Å—Ç—å, –¥–∞–∂–µ –µ—Å–ª–∏ –¥–µ–Ω—å —Å–ª–æ–∂–Ω—ã–π?",
        "–ö–∞–∫–∞—è –º–µ–ª–æ—á—å —Å–µ–≥–æ–¥–Ω—è –±—ã–ª–∞ —Ç—ë–ø–ª–æ–π –∏ –Ω–∞—Å—Ç–æ—è—â–µ–π?",
        "–ö–æ–º—É –∏–ª–∏ —á–µ–º—É —Ç—ã —Ö–æ—á–µ—à—å —Å–∫–∞–∑–∞—Ç—å ¬´—Å–ø–∞—Å–∏–±–æ¬ª?",
        "–ß—Ç–æ —Ç—ã –≤—ã–±–∏—Ä–∞–µ—à—å –∑–∞–º–µ—á–∞—Ç—å —á–∞—â–µ?"
      ],
      15: [
        "–ß—Ç–æ —Å–µ–π—á–∞—Å —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ ‚Äî –≤ –æ–¥–Ω–æ–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–∏.",
        "–ö–∞–∫–∞—è —è—Å–Ω–æ—Å—Ç—å –ø—Ä–∏—à–ª–∞ –±—ã, –µ—Å–ª–∏ —É–±—Ä–∞—Ç—å –ª–∏—à–Ω–µ–µ?",
        "–ß—Ç–æ —Ç—ã —Ç–æ—á–Ω–æ –∑–Ω–∞–µ—à—å, –¥–∞–∂–µ –µ—Å–ª–∏ —Å–æ–º–Ω–µ–≤–∞–µ—à—å—Å—è?",
        "–û–¥–∏–Ω –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –Ω–∞ —Å–µ–≥–æ–¥–Ω—è, –∫–æ—Ç–æ—Ä—ã–π —Å–Ω–∏–º–∞–µ—Ç —Ö–∞–æ—Å.",
        "–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π —Ä–µ—à–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ."
      ],
      16: [
        "–ö–∞–∫–∞—è —ç–º–æ—Ü–∏—è —Å–µ–≥–æ–¥–Ω—è —Å–∞–º–∞—è —Å–∏–ª—å–Ω–∞—è –∏ –ø–æ—á–µ–º—É?",
        "–ß—Ç–æ —Ç—ã —á—É–≤—Å—Ç–≤—É–µ—à—å ‚Äî –∏ —á—Ç–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ?",
        "–ï—Å–ª–∏ –±—ã —ç–º–æ—Ü–∏–∏ –±—ã–ª–∏ –ø–æ–≥–æ–¥–æ–π ‚Äî –∫–∞–∫–∞—è —Å–µ–≥–æ–¥–Ω—è?",
        "–ù–∞–∑–æ–≤–∏ —á—É–≤—Å—Ç–≤–æ –∏ –¥–∞–π –µ–º—É –º–µ—Å—Ç–æ, –Ω–µ –æ—Ü–µ–Ω–∏–≤–∞—è.",
        "–ö–∞–∫ —Ç—ã —Ö–æ—á–µ—à—å —Å–µ–±—è –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ?"
      ],
      17: [
        "–ö–∞–∫–∞—è –∫–∞—Ä—Ç–∏–Ω–∫–∞ –±—É–¥—É—â–µ–≥–æ –º–æ—Ç–∏–≤–∏—Ä—É–µ—Ç —Ç–µ–±—è –±–æ–ª—å—à–µ –≤—Å–µ–≥–æ?",
        "–ö–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–≤–æ—è –∂–∏–∑–Ω—å —á–µ—Ä–µ–∑ –≥–æ–¥ –≤ –¥–µ—Ç–∞–ª—è—Ö?",
        "–ß—Ç–æ —Ç—ã —Ö–æ—á–µ—à—å –≤–∏–¥–µ—Ç—å –≤ —Å–µ–±–µ —á–µ—Ä–µ–∑ 3 –º–µ—Å—è—Ü–∞?",
        "–û–¥–Ω–∞ –ø—Ä–∏–≤—ã—á–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –≤–µ–¥—ë—Ç –∫ —ç—Ç–æ–º—É –≤–∏–¥–µ–Ω–∏—é.",
        "–ó–∞–ø–∏—à–∏ –≤–∏–¥–µ–Ω–∏–µ –∫–∞–∫ –±—É–¥—Ç–æ –æ–Ω–æ —É–∂–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é."
      ],
      18: [
        "–ß—Ç–æ –¥–∞—Å—Ç —Ç–µ–±–µ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ –ø—Ä—è–º–æ —Å–µ–≥–æ–¥–Ω—è?",
        "–ö–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç ¬´—Å–ø–æ–∫–æ–π–Ω—ã–π –ø–ª–∞–Ω¬ª –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ 6 —á–∞—Å–æ–≤?",
        "–ö–∞–∫–∞—è –º—ã—Å–ª—å —Å–Ω–∏–∂–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —à—É–º?",
        "–ß—Ç–æ —Ç—ã –º–æ–∂–µ—à—å –æ—Ç–ø—É—Å—Ç–∏—Ç—å –±–µ–∑ –ø–æ—Ç–µ—Ä—å?",
        "–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π —Ñ—Ä–∞–∑—É –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Ç–∏—à–∏–Ω—ã."
      ],
      19: [
        "–ì–¥–µ —Ç–µ–±–µ –Ω—É–∂–Ω–æ –ø—Ä–æ—è–≤–∏—Ç—å —Å–∏–ª—É —Å–µ–≥–æ–¥–Ω—è?",
        "–ö–∞–∫–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç —Å–º–µ–ª–æ—Å—Ç–∏ –∏ —á–µ—Å—Ç–Ω–æ—Å—Ç–∏?",
        "–ß—Ç–æ —Ç—ã –≤—ã–±–∏—Ä–∞–µ—à—å —Å–¥–µ–ª–∞—Ç—å, –¥–∞–∂–µ –µ—Å–ª–∏ —Å—Ç—Ä–∞—à–Ω–æ?",
        "–û–¥–Ω–∞ –≥—Ä–∞–Ω–∏—Ü–∞, –∫–æ—Ç–æ—Ä—É—é —Ç—ã —É–∫—Ä–µ–ø–∏—à—å.",
        "–ó–∞–ø–∏—à–∏ —Ñ—Ä–∞–∑—É, –∫–æ—Ç–æ—Ä–∞—è –≤–∫–ª—é—á–∞–µ—Ç —Ç–≤–æ—é —Å–∏–ª—É."
      ],
      20: [
        "–ü–∏—à–∏ —Å–≤–æ–±–æ–¥–Ω–æ. –û–¥–Ω–∞ –º—ã—Å–ª—å ‚Äî –∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ.",
        "–ß—Ç–æ —Ö–æ—á–µ—Ç—Å—è —Å–∫–∞–∑–∞—Ç—å —Å–∞–º–æ–º—É —Å–µ–±–µ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞?",
        "–ö–∞–∫–∞—è —Ñ—Ä–∞–∑–∞ —Å—Ç–∞–Ω–µ—Ç –æ–ø–æ—Ä–æ–π —Å–µ–≥–æ–¥–Ω—è?",
        "–ó–∞–ø–∏—à–∏ –≤—Å—ë, —á—Ç–æ –Ω—É–∂–Ω–æ –≤—ã–≥—Ä—É–∑–∏—Ç—å –∏–∑ –≥–æ–ª–æ–≤—ã.",
        "–ß—Ç–æ —Ç—ã –≤—ã–±–∏—Ä–∞–µ—à—å –æ—Å—Ç–∞–≤–∏—Ç—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ, —á—Ç–æ–±—ã —Å—Ç–∞–ª–æ –ª–µ–≥—á–µ?"
      ],
    };

    const LS = {
      theme: "mind_theme",
      entries: "mind_entries_v4",
      streak: "mind_streak_v1",
      affs: "mind_affs_v1"
    };

    function loadJSON(key, fallback){
      try{
        const raw = localStorage.getItem(key);
        if(!raw) return fallback;
        return JSON.parse(raw);
      }catch{
        return fallback;
      }
    }
    function saveJSON(key, val){ localStorage.setItem(key, JSON.stringify(val)); }

    function nowMs(){ return Date.now(); }
    function nowISO(){ return new Date().toISOString(); }
    function dayKeyFromMs(ms){ return new Date(ms).toISOString().slice(0,10); }
    function dayKeyFromISO(iso){ return new Date(iso).toISOString().slice(0,10); }

    // Progress color: red (0) -> green (100)
    function progressColor(percent){
      const p = Math.max(0, Math.min(100, percent));
      const hue = 0 + (120 * (p / 100));
      return `hsl(${hue} 85% 45%)`;
    }
    function setRangeGradient(rangeEl, percent){
      const c = progressColor(percent);
      const neutralLight = "rgba(11,18,32,.12)";
      const neutralDark  = "rgba(233,236,243,.14)";
      const neutral = (document.body.dataset.theme === "dark") ? neutralDark : neutralLight;
      rangeEl.style.background =
        `linear-gradient(90deg, ${c} 0%, ${c} ${percent}%, ${neutral} ${percent}%, ${neutral} 100%)`;
    }

    // --------- State ----------
    let entries = loadJSON(LS.entries, []).map(e => ({
      ...e,
      pinned: !!e.pinned,
      progress: typeof e.progress === "number" ? e.progress : 0,
    }));

    let streakState = loadJSON(LS.streak, null);
    if(!streakState || typeof streakState !== "object"){
      streakState = { streak: 0, lastActiveAt: 0, lastActiveDay: "" };
      saveJSON(LS.streak, streakState);
    }

    let affs = loadJSON(LS.affs, []).map(a => ({ ...a, pinned: !!a.pinned }));

    let activeSegment = null;

    // --- Sphere rotation/inertia (–∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ) ---
    let rotationX = -0.22;   // radians
    let rotationY =  0.36;   // radians
    let velocityX = 0;
    let velocityY = 0;
    let isDragging = false;
    let startX = 0;
    let startY = 0;
    let sphereScale = 1.0;

    // Journal popover + filter
    let openProgressForId = null;
    let journalFilterSegId = ""; // "" => all

    // --------- Elements ----------
    const themeBtn = document.getElementById("themeBtn");
    const mStreak = document.getElementById("mStreak");
    const mToday  = document.getElementById("mToday");

    const sphereWrap = document.getElementById("sphereWrap");
    const sphereEl   = document.getElementById("sphere");

    const bottomBar = document.getElementById("bottomBar");

    const entryModalBg = document.getElementById("entryModalBg");
    const entryTitle   = document.getElementById("entryTitle");
    const entryHint    = document.getElementById("entryHint");
    const entryClose   = document.getElementById("entryClose");
    const editor       = document.getElementById("editor");
    const saveEntryBtn = document.getElementById("saveEntryBtn");

    const journalModalBg = document.getElementById("journalModalBg");
    const journalModal   = document.getElementById("journalModal");
    const journalClose   = document.getElementById("journalClose");
    const journalBody    = document.getElementById("journalBody");
    const openJournalBtn = document.getElementById("openJournalBtn");
    const journalFilter  = document.getElementById("journalFilter");

    const openAffBtn = document.getElementById("openAffBtn");
    const affModalBg = document.getElementById("affModalBg");
    const affModal   = document.getElementById("affModal");
    const affClose   = document.getElementById("affClose");
    const affBody    = document.getElementById("affBody");
    const affInput   = document.getElementById("affInput");
    const affAddBtn  = document.getElementById("affAddBtn");

    // --------- Theme ----------
    function initTheme(){
      const t = localStorage.getItem(LS.theme);
      document.body.dataset.theme = (t === "dark") ? "dark" : "light";
    }
    function toggleTheme(){
      const cur = document.body.dataset.theme === "dark" ? "dark" : "light";
      const next = cur === "dark" ? "light" : "dark";
      document.body.dataset.theme = next;
      localStorage.setItem(LS.theme, next);

      const openRange = document.querySelector('input[type="range"][data-open="1"]');
      if(openRange){
        setRangeGradient(openRange, Number(openRange.value));
      }
    }

    // --------- VH for iOS ----------
    function setVh(){
      document.documentElement.style.setProperty("--vh", (window.innerHeight * 0.01) + "px");
    }

    // --------- Bottom bar height -> remove empty space ----------
    function updateBottomBarHeight(){
      if(!bottomBar) return;
      const rect = bottomBar.getBoundingClientRect();
      // +4 –∫–∞–∫ –º–∞–ª–µ–Ω—å–∫–∏–π –∑–∞–ø–∞—Å, —á—Ç–æ–±—ã –Ω–∏—á–µ–≥–æ –Ω–µ "–ª–∏–ø–ª–æ" –≤–ø—Ä–∏—Ç—ã–∫
      const h = Math.max(76, Math.round(rect.height) + 4);
      document.documentElement.style.setProperty("--bottomBarH", h + "px");
    }

    // --------- Streak ----------
    function normalizeStreakOnBoot(){
      const now = nowMs();
      const last = Number(streakState.lastActiveAt || 0);
      if(!last) return;

      const diff = now - last;
      const dayNow = dayKeyFromMs(now);
      if(diff > 24 * 60 * 60 * 1000){
        streakState.streak = 0;
        streakState.lastActiveDay = dayNow;
        saveJSON(LS.streak, streakState);
      }
    }

    function registerActivityForStreak(){
      const now = nowMs();
      const dayNow = dayKeyFromMs(now);

      if(streakState.lastActiveAt && (now - streakState.lastActiveAt) > 24*60*60*1000){
        streakState.streak = 0;
      }
      if(streakState.lastActiveDay !== dayNow){
        streakState.streak = (Number(streakState.streak) || 0) + 1;
        streakState.lastActiveDay = dayNow;
      }
      streakState.lastActiveAt = now;
      saveJSON(LS.streak, streakState);
    }

    // --------- Metrics ----------
    function computeMetrics(){
      const today = dayKeyFromMs(nowMs());
      const todayCount = entries.filter(e => dayKeyFromISO(e.createdAt) === today).length;
      const streak = Number(streakState.streak || 0);
      return { streak, todayCount };
    }
    function renderMetrics(){
      const m = computeMetrics();
      mStreak.textContent = `${m.streak} üî•`;
      mToday.textContent  = `${m.todayCount} üìù`;
    }

    // --------- Sphere ----------
    const nodes = [];
    function buildSphere(){
      sphereEl.innerHTML = "";
      nodes.length = 0;

      for(let i=0;i<segments.length;i++){
        const seg = segments[i];
        const node = document.createElement("div");
        node.className = "node";

        const chip = document.createElement("div");
        chip.className = "chip noSelect";
        chip.innerHTML = `<span class="e">${seg.emoji}</span><span>${seg.name}</span>`;
        chip.addEventListener("click", (ev) => {
          ev.preventDefault();
          ev.stopPropagation();
          openEntry(seg);
        });

        node.appendChild(chip);
        sphereEl.appendChild(node);
        nodes.push({ node, chip, seg });
      }

      // –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä –¥–Ω–µ–≤–Ω–∏–∫–∞
      fillJournalFilterOptions();

      layoutSphere();
    }

    function fillJournalFilterOptions(){
      if(!journalFilter) return;
      // –æ—á–∏—Å—Ç–∏—Ç—å –∏ —Å–æ–±—Ä–∞—Ç—å –∑–∞–Ω–æ–≤–æ (–≤–¥—Ä—É–≥ –º–µ–Ω—è–ª–∏—Å—å —Å–µ–≥–º–µ–Ω—Ç—ã)
      journalFilter.innerHTML = `<option value="">–í—Å–µ –∑–∞–ø–∏—Å–∏</option>`;
      for(const s of segments){
        const opt = document.createElement("option");
        opt.value = String(s.id);
        opt.textContent = `${s.emoji} ${s.name}`;
        journalFilter.appendChild(opt);
      }
      // –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω–æ–µ
      journalFilter.value = journalFilterSegId;
    }

    function clamp(v, a, b){ return Math.max(a, Math.min(b, v)); }

    // –ü–æ–∑–∏—Ü–∏–∏ –Ω–∞ —Å—Ñ–µ—Ä–µ + –≤—Ä–∞—â–µ–Ω–∏–µ/–º–∞—Å—à—Ç–∞–±/–ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å (–∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ)
    function layoutSphere(){
      const rect = sphereWrap.getBoundingClientRect();
      const radius = Math.min(rect.width, rect.height) * 0.36;

      const len = nodes.length || 1;

      for(let i=0;i<len;i++){
        const item = nodes[i];

        // –†–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ –º—ã—Å–ª–µ–π –Ω–∞ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ —Å—Ñ–µ—Ä—ã
        const phi = Math.acos(-1 + (2*i)/len);
        const theta = Math.sqrt(len * Math.PI) * phi;

        let x = radius * Math.sin(phi) * Math.cos(theta);
        let y = radius * Math.sin(phi) * Math.sin(theta);
        let z = radius * Math.cos(phi);

        // –í—Ä–∞—â–µ–Ω–∏–µ (XY)
        const cosY = Math.cos(rotationY), sinY = Math.sin(rotationY);
        const cosX = Math.cos(rotationX), sinX = Math.sin(rotationX);

        const x1 = x*cosY - z*sinY;
        const z1 = x*sinY + z*cosY;
        const y1 = y*cosX - z1*sinX;
        const z2 = y*sinX + z1*cosX;

        // –ú–∞—Å—à—Ç–∞–± –∏ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –ø–æ –≥–ª—É–±–∏–Ω–µ
        const depth = (z2 + radius) / (2*radius); // 0..1
        const scale = 0.55 + depth * 0.55;        // 0.55..1.10
        const opacity = 0.28 + depth * 0.72;      // 0.28..1.0

        item.node.style.transform = `translate3d(calc(-50% + ${x1}px), calc(-50% + ${y1}px), 0)`;
        item.node.style.zIndex = String(Math.floor(scale * 1000));

        // –ß–∏–ø—ã "–≤—Å–µ–≥–¥–∞ –ª–∏—Ü–æ–º" (–º—ã –Ω–µ –∫—Ä—É—Ç–∏–º –∏—Ö 3D-–º–∞—Ç—Ä–∏—Ü–∞–º–∏, –ø–æ—ç—Ç–æ–º—É –∑–µ—Ä–∫–∞–ª–∞ –Ω–µ—Ç)
        item.chip.style.transform = `scale(${(scale * sphereScale).toFixed(4)})`;
        item.chip.style.opacity = opacity.toFixed(3);

        // –ª–µ–≥–∫–∞—è –≥–ª—É–±–∏–Ω–∞: –¥–∞–ª—å–Ω–∏–µ —á—É—Ç—å –º—è–≥—á–µ, –Ω–æ –±–µ–∑ "—Ä—è–±–µ–π"
        item.chip.style.filter = opacity < 0.42 ? "blur(0.2px)" : "none";
      }
    }

    // --- Drag / inertia ---
    function onDragStart(clientX, clientY){
      isDragging = true;
      startX = clientX;
      startY = clientY;
      velocityX = 0;
      velocityY = 0;
    }

    function onDragMove(clientX, clientY){
      if(!isDragging) return;
      const dx = clientX - startX;
      const dy = clientY - startY;

      rotationY += dx * 0.005;
      rotationX -= dy * 0.005;

      // –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ X, —á—Ç–æ–±—ã –Ω–µ "–ø–µ—Ä–µ–≤–æ—Ä–∞—á–∏–≤–∞–ª–æ"
      rotationX = clamp(rotationX, -1.25, 1.25);

      velocityX = dy * 0.002;
      velocityY = dx * 0.002;

      startX = clientX;
      startY = clientY;

      layoutSphere();
    }

    function onDragEnd(){
      isDragging = false;
    }

    function animate(){
      if(!isDragging){
        rotationX += velocityX;
        rotationY += velocityY;

        velocityX *= 0.95;
        velocityY *= 0.95;

        // –µ—Å–ª–∏ –ø–æ—á—Ç–∏ –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å ‚Äî –ª—ë–≥–∫–∏–π –∞–≤—Ç–æ—Å–ø–∏–Ω, —á—Ç–æ–±—ã "–∂–∏–ª–∞"
        if(Math.abs(velocityX) < 0.00002 && Math.abs(velocityY) < 0.00002){
          rotationY += 0.00135;
        }

        layoutSphere();
      }
      requestAnimationFrame(animate);
    }

    // Wheel zoom (desktop)
    sphereWrap.addEventListener("wheel", (e) => {
      e.preventDefault();
      sphereScale += e.deltaY * -0.001;
      sphereScale = Math.min(Math.max(0.6, sphereScale), 1.5);
      layoutSphere();
    }, { passive:false });

    // Pointer events (mobile webview friendly)
    sphereWrap.addEventListener("pointerdown", (e) => {
      sphereWrap.setPointerCapture?.(e.pointerId);
      onDragStart(e.clientX, e.clientY);
    });
    sphereWrap.addEventListener("pointermove", (e) => onDragMove(e.clientX, e.clientY));
    sphereWrap.addEventListener("pointerup", () => onDragEnd());
    sphereWrap.addEventListener("pointercancel", () => onDragEnd());

    // --------- Entry modal ----------
    function pickHint(segId){
      const arr = hintsBySegment[segId] || [
        "–ó–∞–ø–∏—à–∏ –æ–¥–Ω—É –º—ã—Å–ª—å –∫–æ—Ä–æ—Ç–∫–æ –∏ —á–µ—Å—Ç–Ω–æ.",
        "–ß—Ç–æ —Ç—ã –≤—ã–±–∏—Ä–∞–µ—à—å –¥—É–º–∞—Ç—å —Å–µ–≥–æ–¥–Ω—è?",
        "–û–¥–Ω–∞ —Ñ—Ä–∞–∑–∞, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–¥–¥–µ—Ä–∂–∏—Ç —Ç–µ–±—è."
      ];
      return arr[Math.floor(Math.random() * arr.length)];
    }

    function openEntry(seg){
      activeSegment = seg;
      entryTitle.textContent = `${seg.emoji} ${seg.name}`;
      entryHint.textContent = pickHint(seg.id);
      editor.textContent = "";
      entryModalBg.classList.add("show");
      setTimeout(() => editor.focus(), 0);
    }

    function closeEntry(){
      entryModalBg.classList.remove("show");
      activeSegment = null;
      editor.textContent = "";
      setTimeout(() => { setVh(); updateBottomBarHeight(); }, 50);
    }

    function saveEntry(){
      if(!activeSegment) return;

      const text = (editor.textContent || "").trim();
      if(!text) return;

      const entry = {
        id: crypto.randomUUID(),
        segmentId: activeSegment.id,
        segmentName: activeSegment.name,
        segmentEmoji: activeSegment.emoji,
        html: escapeHtmlToParagraphs(text),
        createdAt: nowISO(),
        pinned: false,
        progress: 0,
      };

      entries.push(entry);
      saveJSON(LS.entries, entries);

      registerActivityForStreak();
      renderMetrics();
      closeEntry();
    }

    function escapeHtmlToParagraphs(text){
      const safe = text
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;");
      return safe.split("\n").map(line => line ? line : "&nbsp;").join("<br>");
    }

    // --------- Journal (pin/progress/delete/filter) ----------
    function openJournal(){
      openProgressForId = null;
      renderJournal();
      journalModalBg.classList.add("show");
    }
    function closeJournal(){
      journalModalBg.classList.remove("show");
      openProgressForId = null;
      setTimeout(() => { setVh(); updateBottomBarHeight(); }, 50);
    }

    function togglePin(entryId){
      const idx = entries.findIndex(e => e.id === entryId);
      if(idx === -1) return;
      entries[idx].pinned = !entries[idx].pinned;
      saveJSON(LS.entries, entries);
      renderJournal();
    }

    function toggleProgressMenu(entryId){
      openProgressForId = (openProgressForId === entryId) ? null : entryId;
      renderJournal();

      if(openProgressForId){
        requestAnimationFrame(() => {
          const entryEl = journalBody.querySelector(`[data-id="${openProgressForId}"]`);
          if(!entryEl) return;
          ensureEntryPopoverVisible(journalModal, entryEl);
        });
      }
    }

    function ensureEntryPopoverVisible(modalEl, entryEl){
      const pop = entryEl.querySelector(".pop");
      if(!pop || pop.style.display === "none") return;

      const mRect = modalEl.getBoundingClientRect();
      const pRect = pop.getBoundingClientRect();

      const topSafe = mRect.top + 72;
      const bottomSafe = mRect.bottom - 24;

      if(pRect.bottom > bottomSafe){
        const delta = pRect.bottom - bottomSafe + 8;
        modalEl.scrollTop += delta;
      } else if(pRect.top < topSafe){
        const delta = topSafe - pRect.top + 8;
        modalEl.scrollTop -= delta;
      }
    }

    function setProgress(entryId, value){
      const idx = entries.findIndex(e => e.id === entryId);
      if(idx === -1) return;
      entries[idx].progress = value;
      saveJSON(LS.entries, entries);
      renderJournal();
    }

    function deleteEntry(entryId){
      const ok = confirm("–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.");
      if(!ok) return;
      entries = entries.filter(e => e.id !== entryId);
      saveJSON(LS.entries, entries);
      renderMetrics();
      renderJournal();
    }

    function renderJournal(){
      journalBody.innerHTML = "";

      // —Ñ–∏–ª—å—Ç—Ä
      const filterId = journalFilterSegId ? Number(journalFilterSegId) : null;

      const filteredEntries = filterId
        ? entries.filter(e => Number(e.segmentId) === filterId)
        : entries.slice();

      if(filteredEntries.length === 0){
        const empty = document.createElement("div");
        empty.className = "emptyBox";
        empty.innerHTML =
          `<div style="font-weight:900; color:var(--text); margin-bottom:6px;">–ü–æ–∫–∞ –Ω–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>
           <div>–ù–∞–∂–º–∏ –Ω–∞ –ª—é–±–æ–π —Å–µ–∫—Ç–æ—Ä –Ω–∞ —Å—Ñ–µ—Ä–µ –∏ —Å–¥–µ–ª–∞–π –ø–µ—Ä–≤—É—é –∑–∞–ø–∏—Å—å. –í—Å–µ –∑–∞–ø–∏—Å–∏ –æ—Å—Ç–∞—é—Ç—Å—è —Å —Ç–æ–±–æ–π.</div>`;
        journalBody.appendChild(empty);
        return;
      }

      const pinned = filteredEntries.filter(e => e.pinned).sort((a,b) => a.createdAt < b.createdAt ? 1 : -1);
      const normal = filteredEntries.filter(e => !e.pinned).sort((a,b) => a.createdAt < b.createdAt ? 1 : -1);
      const sorted = [...pinned, ...normal];

      for(const e of sorted){
        const block = document.createElement("div");
        block.className = "entry";
        block.dataset.id = e.id;

        const dt = new Date(e.createdAt);
        const when = dt.toLocaleString();

        const pct = Math.max(0, Math.min(100, Number(e.progress || 0)));
        const pctColor = progressColor(pct);

        block.innerHTML = `
          <div class="entryTop">
            <div class="entryTag" title="${e.segmentName}">
              <span class="segEmoji">${e.segmentEmoji}</span>
            </div>

            <div class="entryRight">
              <div class="progressPill" style="border-color:${pctColor}33;">
                <span style="color:${pctColor};">${pct}%</span>
              </div>
              <button class="miniBtn noSelect progressBtn" title="–ü—Ä–æ–≥—Ä–µ—Å—Å">üìà</button>
              <button class="miniBtn noSelect pinBtn ${e.pinned ? "pinned":""}" title="–ó–∞–∫—Ä–µ–ø–∏—Ç—å">üìå</button>
              <button class="miniBtn noSelect delBtn" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
              <span class="entryDate">${when}</span>
            </div>
          </div>

          <div class="entryText"></div>

          <div class="pop" style="display:${openProgressForId === e.id ? "block" : "none"};">
            <div class="popTop">
              <div>–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
              <div class="popVal"><span style="color:${pctColor};">${pct}%</span></div>
            </div>
            <div class="rangeWrap">
              <input type="range" min="0" max="100" step="1" value="${pct}" data-open="${openProgressForId === e.id ? "1":"0"}">
            </div>
          </div>
        `;

        const textEl = block.querySelector(".entryText");
        textEl.innerHTML = e.html;

        const pinBtn = block.querySelector(".pinBtn");
        const progBtn = block.querySelector(".progressBtn");
        const delBtn  = block.querySelector(".delBtn");
        const range   = block.querySelector('input[type="range"]');

        pinBtn.addEventListener("click", () => togglePin(e.id));
        progBtn.addEventListener("click", () => toggleProgressMenu(e.id));
        delBtn.addEventListener("click", () => deleteEntry(e.id));

        if(range){
          setRangeGradient(range, pct);

          range.addEventListener("input", () => {
            const v = Number(range.value);
            setRangeGradient(range, v);

            const valEl = block.querySelector(".popVal");
            const pill  = block.querySelector(".progressPill");
            const c = progressColor(v);

            valEl.innerHTML = `<span style="color:${c};">${v}%</span>`;
            pill.innerHTML  = `<span style="color:${c};">${v}%</span>`;
            pill.style.borderColor = `${c}33`;
          });

          range.addEventListener("change", () => {
            const v = Number(range.value);
            setProgress(e.id, v);
          });
        }

        journalBody.appendChild(block);
      }
    }

    // --------- Affirmations ----------
    function openAff(){
      renderAffs();
      affModalBg.classList.add("show");
      setTimeout(() => affInput.focus(), 0);
    }
    function closeAff(){
      affModalBg.classList.remove("show");
      setTimeout(() => { setVh(); updateBottomBarHeight(); }, 50);
    }

    function addAff(){
      const raw = (affInput.value || "").trim();
      if(!raw) return;

      const item = {
        id: crypto.randomUUID(),
        text: raw,
        createdAt: nowISO(),
        pinned: false
      };
      affs.push(item);
      saveJSON(LS.affs, affs);
      affInput.value = "";
      renderAffs();
    }

    function toggleAffPin(id){
      const idx = affs.findIndex(a => a.id === id);
      if(idx === -1) return;
      affs[idx].pinned = !affs[idx].pinned;
      saveJSON(LS.affs, affs);
      renderAffs();
    }

    function deleteAff(id){
      const ok = confirm("–£–¥–∞–ª–∏—Ç—å –∞—Ñ—Ñ–∏—Ä–º–∞—Ü–∏—é?");
      if(!ok) return;
      affs = affs.filter(a => a.id !== id);
      saveJSON(LS.affs, affs);
      renderAffs();
    }

    function renderAffs(){
      affBody.innerHTML = "";

      if(affs.length === 0){
        const empty = document.createElement("div");
        empty.className = "emptyBox";
        empty.innerHTML =
          `<div style="font-weight:900; color:var(--text); margin-bottom:6px;">–ü–æ–∫–∞ –Ω–µ—Ç –∞—Ñ—Ñ–∏—Ä–º–∞—Ü–∏–π</div>
           <div>–î–æ–±–∞–≤—å –æ–¥–Ω—É —Ñ—Ä–∞–∑—É –≤—ã—à–µ ‚Äî –∫–æ—Ä–æ—Ç–∫—É—é, —è—Å–Ω—É—é –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â—É—é.</div>`;
        affBody.appendChild(empty);
        return;
      }

      const pinned = affs.filter(a => a.pinned).sort((a,b) => a.createdAt < b.createdAt ? 1 : -1);
      const normal = affs.filter(a => !a.pinned).sort((a,b) => a.createdAt < b.createdAt ? 1 : -1);
      const sorted = [...pinned, ...normal];

      for(const a of sorted){
        const block = document.createElement("div");
        block.className = "entry";
        block.dataset.id = a.id;

        const dt = new Date(a.createdAt);
        const when = dt.toLocaleString();

        const quoted = `¬´${escapeText(a.text)}¬ª`;

        block.innerHTML = `
          <div class="entryTop">
            <div class="entryTag" title="–ê—Ñ—Ñ–∏—Ä–º–∞—Ü–∏—è">
              <span style="font-size:16px">‚ú®</span>
            </div>

            <div class="entryRight">
              <button class="miniBtn noSelect pinBtn ${a.pinned ? "pinned":""}" title="–ó–∞–∫—Ä–µ–ø–∏—Ç—å">üìå</button>
              <button class="miniBtn noSelect delBtn" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
              <span class="entryDate">${when}</span>
            </div>
          </div>

          <div class="entryText" style="font-weight:900;">${quoted}</div>
        `;

        const pinBtn = block.querySelector(".pinBtn");
        const delBtn = block.querySelector(".delBtn");
        pinBtn.addEventListener("click", () => toggleAffPin(a.id));
        delBtn.addEventListener("click", () => deleteAff(a.id));

        affBody.appendChild(block);
      }
    }

    function escapeText(t){
      return (t || "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;");
    }

    // --------- Events ----------
    themeBtn.addEventListener("click", toggleTheme);

    entryClose.addEventListener("click", closeEntry);
    entryModalBg.addEventListener("click", (e) => { if(e.target === entryModalBg) closeEntry(); });
    saveEntryBtn.addEventListener("click", saveEntry);

    openJournalBtn.addEventListener("click", openJournal);
    journalClose.addEventListener("click", closeJournal);
    journalModalBg.addEventListener("click", (e) => { if(e.target === journalModalBg) closeJournal(); });

    journalFilter.addEventListener("change", () => {
      journalFilterSegId = journalFilter.value || "";
      openProgressForId = null;
      renderJournal();
    });

    openAffBtn.addEventListener("click", openAff);
    affClose.addEventListener("click", closeAff);
    affModalBg.addEventListener("click", (e) => { if(e.target === affModalBg) closeAff(); });
    affAddBtn.addEventListener("click", addAff);
    affInput.addEventListener("keydown", (e) => {
      if(e.key === "Enter" && !e.shiftKey){
        e.preventDefault();
        addAff();
      }
    });

    // Prevent pinch zoom on iOS Safari (extra)
    document.addEventListener("gesturestart", (e) => e.preventDefault());
    document.addEventListener("gesturechange", (e) => e.preventDefault());
    document.addEventListener("gestureend", (e) => e.preventDefault());

    // Resize observer
    const ro = new ResizeObserver(() => {
      updateBottomBarHeight();
      layoutSphere();
    });

    // --------- Boot ----------
    initTheme();

    setVh();
    window.addEventListener("resize", () => { setVh(); updateBottomBarHeight(); layoutSphere(); });
    window.addEventListener("orientationchange", () => { setVh(); updateBottomBarHeight(); layoutSphere(); });

    normalizeStreakOnBoot();
    renderMetrics();
    buildSphere();
    ro.observe(sphereWrap);

    // –º–µ—Ä—è–µ–º –Ω–∏–∑ –ø–æ—Å–ª–µ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏
    requestAnimationFrame(() => {
      updateBottomBarHeight();
      layoutSphere();
    });

    // –∑–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –∏–Ω–µ—Ä—Ü–∏–∏
    animate();
  </script>
</body>
</html>
